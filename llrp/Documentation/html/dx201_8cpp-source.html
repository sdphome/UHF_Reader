<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LTKCPP-- LLRP Toolkit C Plus Plus Library: dx201.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Tests</a></div>
<h1>dx201.cpp</h1><a href="dx201_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> ***************************************************************************</span>
00004 <span class="comment"> *  Copyright 2007,2008 Impinj, Inc.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the "License");</span>
00007 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
00008 <span class="comment"> *  You may obtain a copy of the License at</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
00013 <span class="comment"> *  distributed under the License is distributed on an "AS IS" BASIS,</span>
00014 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
00015 <span class="comment"> *  See the License for the specific language governing permissions and</span>
00016 <span class="comment"> *  limitations under the License.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> ***************************************************************************</span>
00019 <span class="comment"> */</span>
00020 
00056 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00057 <span class="preprocessor">#ifdef linux</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
00059 <span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>
00061 <span class="preprocessor">#include "<a class="code" href="ltkcpp_8h.html">ltkcpp.h</a>"</span>
00062 
00063 <span class="keyword">using</span> <span class="keyword">namespace </span>LLRP;
00064 
00065 
00066 <span class="keyword">class </span>CMyApplication
00067 {
00068   <span class="keyword">public</span>:
00070     <span class="keywordtype">int</span>                         m_Verbose;
00071 
00074     <span class="keywordtype">int</span>                         m_ModeIndex;
00076     <span class="keywordtype">int</span>                         m_Quiet;
00078     <span class="keywordtype">int</span>                         m_nTagReport;
00079 
00081     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               m_pConnectionToReader;
00082 
00083     <span class="keyword">inline</span>
00084     CMyApplication (<span class="keywordtype">void</span>)
00085      : m_Verbose(0), m_ModeIndex(-1), m_Quiet(0),
00086        m_nTagReport(0), m_pConnectionToReader(NULL)
00087     {}
00088 
00089     <span class="keywordtype">int</span>
00090     run (
00091       <span class="keywordtype">char</span> *                    pReaderHostName);
00092 
00093     <span class="keywordtype">int</span>
00094     checkConnectionStatus (<span class="keywordtype">void</span>);
00095 
00096     <span class="keywordtype">int</span>
00097     scrubConfiguration (<span class="keywordtype">void</span>);
00098 
00099     <span class="keywordtype">int</span>
00100     resetConfigurationToFactoryDefaults (<span class="keywordtype">void</span>);
00101 
00102     <span class="keywordtype">int</span>
00103     deleteAllROSpecs (<span class="keywordtype">void</span>);
00104 
00105     <span class="keywordtype">int</span>
00106     deleteAllAccessSpecs (<span class="keywordtype">void</span>);
00107 
00108     <span class="keywordtype">int</span>
00109     prepareReader(<span class="keywordtype">void</span>);
00110 
00111     <span class="keywordtype">int</span>
00112     getAllCapabilities (<span class="keywordtype">void</span>);
00113 
00114     <span class="keywordtype">int</span>
00115     getAllConfiguration (<span class="keywordtype">void</span>);
00116 
00117     <span class="keywordtype">int</span>
00118     configureNotificationStates (<span class="keywordtype">void</span>);
00119 
00120     <span class="keywordtype">int</span>
00121     addROSpec (<span class="keywordtype">void</span>);
00122 
00123     <span class="keywordtype">int</span>
00124     enableROSpec (<span class="keywordtype">void</span>);
00125 
00126     <span class="keywordtype">int</span>
00127     startAndMonitorOperation (<span class="keywordtype">void</span>);
00128 
00129     <span class="keywordtype">void</span>
00130     printTagReportData (
00131       <a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> *       pRO_ACCESS_REPORT);
00132 
00133     <span class="keywordtype">void</span>
00134     printOneTagReportData (
00135       <a class="code" href="classLLRP_1_1CTagReportData.html">CTagReportData</a> *          pTagReportData);
00136 
00137     <span class="keywordtype">int</span>
00138     checkLLRPStatus (
00139       <a class="code" href="classLLRP_1_1CLLRPStatus.html">CLLRPStatus</a> *             pLLRPStatus,
00140       <span class="keywordtype">char</span> *                    pWhatStr);
00141 
00142     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
00143     transact (
00144       <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                pSendMsg);
00145 
00146     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
00147     recvMessage (
00148       <span class="keywordtype">int</span>                       nMaxMS);
00149 
00150     <span class="keywordtype">int</span>
00151     sendMessage (
00152       <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                pSendMsg);
00153 
00154     <span class="keywordtype">void</span>
00155     printXMLMessage (
00156       <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                pMessage);
00157 };
00158 
00159 
00160 <span class="comment">/* BEGIN forward declarations */</span>
00161 <span class="keywordtype">int</span>
00162 <a class="code" href="example1_8cpp.html#a0">main</a> (
00163   <span class="keywordtype">int</span>                           ac,
00164   <span class="keywordtype">char</span> *                        av[]);
00165 
00166 <span class="keywordtype">void</span>
00167 <a class="code" href="dx201_8cpp.html#a1">usage</a> (
00168   <span class="keywordtype">char</span> *                        pProgName);
00169 <span class="comment">/* END forward declarations */</span>
00170 
00171 
00193 <span class="keywordtype">int</span>
00194 <a class="code" href="example1_8cpp.html#a0">main</a> (
00195   <span class="keywordtype">int</span>                           ac,
00196   <span class="keywordtype">char</span> *                        av[])
00197 {
00198     CMyApplication              myApp;
00199     <span class="keywordtype">char</span> *                      pReaderHostName;
00200     <span class="keywordtype">int</span>                         rc;
00201 <span class="preprocessor">#ifdef linux</span>
00202 <span class="preprocessor"></span>    <span class="keywordtype">char</span> *                      pMemHiwatAtStart = (<span class="keywordtype">char</span>*)sbrk(0);
00203 <span class="preprocessor">#endif</span>
00204 <span class="preprocessor"></span>
00205     <span class="comment">/*</span>
00206 <span class="comment">     * Process comand arguments, determine reader name</span>
00207 <span class="comment">     * and verbosity level.</span>
00208 <span class="comment">     */</span>
00209     <span class="keywordflow">if</span>(ac == 2)
00210     {
00211         pReaderHostName = av[1];
00212     }
00213     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ac == 3)
00214     {
00215         <span class="keywordtype">char</span> *                  p = av[1];
00216 
00217         <span class="keywordflow">while</span>(*p)
00218         {
00219             <span class="keywordflow">switch</span>(*p++)
00220             {
00221             <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:   <span class="comment">/* linux conventional option warn char */</span>
00222             <span class="keywordflow">case</span> <span class="charliteral">'/'</span>:   <span class="comment">/* Windows/DOS conventional option warn char */</span>
00223                 <span class="keywordflow">break</span>;
00224 
00225             <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00226             <span class="keywordflow">case</span> <span class="charliteral">'V'</span>:
00227                 myApp.m_Verbose++;
00228                 <span class="keywordflow">break</span>;
00229 
00230             <span class="keywordflow">case</span> <span class="charliteral">'q'</span>:
00231             <span class="keywordflow">case</span> <span class="charliteral">'Q'</span>:
00232                 myApp.m_Quiet++;
00233                 <span class="keywordflow">break</span>;
00234 
00235             <span class="keywordflow">case</span> <span class="charliteral">'0'</span>: <span class="keywordflow">case</span> <span class="charliteral">'1'</span>: <span class="keywordflow">case</span> <span class="charliteral">'2'</span>: <span class="keywordflow">case</span> <span class="charliteral">'3'</span>: <span class="keywordflow">case</span> <span class="charliteral">'4'</span>: <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
00236                 myApp.m_ModeIndex = p[-1] - <span class="charliteral">'0'</span>;
00237                 <span class="keywordflow">break</span>;
00238 
00239             <span class="keywordflow">default</span>:
00240                 <a class="code" href="dx201_8cpp.html#a1">usage</a>(av[0]);
00241                 <span class="comment">/* no return */</span>
00242                 <span class="keywordflow">break</span>;
00243             }
00244         }
00245 
00246         pReaderHostName = av[2];
00247     }
00248     <span class="keywordflow">else</span>
00249     {
00250         <a class="code" href="dx201_8cpp.html#a1">usage</a>(av[0]);
00251         <span class="comment">/* no return */</span>
00252     }
00253 
00254     <span class="comment">/*</span>
00255 <span class="comment">     * Run application, capture return value for exit status</span>
00256 <span class="comment">     */</span>
00257     rc = myApp.run(pReaderHostName);
00258 
00259     printf(<span class="stringliteral">"INFO: Done\n"</span>);
00260 
00261 <span class="preprocessor">#ifdef linux</span>
00262 <span class="preprocessor"></span>    {
00263         <span class="keywordtype">char</span> *              pMemHiwatAtEnd = (<span class="keywordtype">char</span>*)sbrk(0);
00264 
00265         printf(<span class="stringliteral">"INFO: Needed %d bytes of heap\n"</span>,
00266             pMemHiwatAtEnd - pMemHiwatAtStart);
00267     }
00268 <span class="preprocessor">#endif</span>
00269 <span class="preprocessor"></span>
00270     <span class="comment">/*</span>
00271 <span class="comment">     * Exit with the right status.</span>
00272 <span class="comment">     */</span>
00273     <span class="keywordflow">if</span>(0 == rc)
00274     {
00275         exit(0);
00276     }
00277     <span class="keywordflow">else</span>
00278     {
00279         exit(2);
00280     }
00281     <span class="comment">/*NOTREACHED*/</span>
00282 }
00283 
00284 
00296 <span class="keywordtype">void</span>
00297 <a class="code" href="dx201_8cpp.html#a1">usage</a> (
00298   <span class="keywordtype">char</span> *                        pProgName)
00299 {
00300 <span class="preprocessor">#ifdef linux</span>
00301 <span class="preprocessor"></span>    printf(<span class="stringliteral">"Usage: %s [-v[v]] READERHOSTNAME\n"</span>, pProgName);
00302     printf(<span class="stringliteral">"\n"</span>);
00303     printf(<span class="stringliteral">"Each -v increases verbosity level\n"</span>);
00304 <span class="preprocessor">#endif </span><span class="comment">/* linux */</span>
00305 <span class="preprocessor">#ifdef WIN32</span>
00306 <span class="preprocessor"></span>    printf(<span class="stringliteral">"Usage: %s [/v[v]] READERHOSTNAME\n"</span>, pProgName);
00307     printf(<span class="stringliteral">"\n"</span>);
00308     printf(<span class="stringliteral">"Each /v increases verbosity level\n"</span>);
00309 <span class="preprocessor">#endif </span><span class="comment">/* WIN32 */</span>
00310     exit(1);
00311 }
00312 
00313 
00343 <span class="keywordtype">int</span>
00344 CMyApplication::run (
00345   <span class="keywordtype">char</span> *                        pReaderHostName)
00346 {
00347     <a class="code" href="classLLRP_1_1CTypeRegistry.html">CTypeRegistry</a> *             pTypeRegistry;
00348     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn;
00349     <span class="keywordtype">int</span>                         rc;
00350 
00351     <span class="comment">/*</span>
00352 <span class="comment">     * Allocate the type registry. This is needed</span>
00353 <span class="comment">     * by the connection to decode.</span>
00354 <span class="comment">     */</span>
00355     pTypeRegistry = getTheTypeRegistry();
00356     <span class="keywordflow">if</span>(NULL == pTypeRegistry)
00357     {
00358         printf(<span class="stringliteral">"ERROR: getTheTypeRegistry failed\n"</span>);
00359         <span class="keywordflow">return</span> -1;
00360     }
00361 
00362     <span class="comment">/*</span>
00363 <span class="comment">     * Construct a connection (LLRP::CConnection).</span>
00364 <span class="comment">     * Using a 32kb max frame size for send/recv.</span>
00365 <span class="comment">     * The connection object is ready for business</span>
00366 <span class="comment">     * but not actually connected to the reader yet.</span>
00367 <span class="comment">     */</span>
00368     pConn = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a>(pTypeRegistry, 32u*1024u);
00369     <span class="keywordflow">if</span>(NULL == pConn)
00370     {
00371         printf(<span class="stringliteral">"ERROR: new CConnection failed\n"</span>);
00372         <span class="keywordflow">return</span> -2;
00373     }
00374 
00375     <span class="comment">/*</span>
00376 <span class="comment">     * Open the connection to the reader</span>
00377 <span class="comment">     */</span>
00378     <span class="keywordflow">if</span>(m_Verbose)
00379     {
00380         printf (<span class="stringliteral">"INFO: Connecting to %s....\n"</span>, pReaderHostName);
00381     }
00382 
00383     rc = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a2">openConnectionToReader</a>(pReaderHostName);
00384     <span class="keywordflow">if</span>(0 != rc)
00385     {
00386         printf(<span class="stringliteral">"ERROR: connect: %s (%d)\n"</span>, pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a3">getConnectError</a>(), rc);
00387         <span class="keyword">delete</span> pConn;
00388         <span class="keywordflow">return</span> -3;
00389     }
00390 
00391     <span class="comment">/*</span>
00392 <span class="comment">     * Record the pointer to the connection object so other</span>
00393 <span class="comment">     * routines can use it.</span>
00394 <span class="comment">     */</span>
00395     m_pConnectionToReader = pConn;
00396 
00397     <span class="keywordflow">if</span>(m_Verbose)
00398     {
00399         printf (<span class="stringliteral">"INFO: Connected, checking status....\n"</span>);
00400     }
00401 
00402     <span class="comment">/*</span>
00403 <span class="comment">     * Commence the sequence and check for errors as we go.</span>
00404 <span class="comment">     * See comments for each routine for details.</span>
00405 <span class="comment">     * Each routine prints messages per verbose level.</span>
00406 <span class="comment">     */</span>
00407     rc = 1;
00408     <span class="keywordflow">if</span>(0 == checkConnectionStatus())
00409     {
00410         rc = 2;
00411         <span class="keywordflow">if</span>(0 == scrubConfiguration())
00412         {
00413             rc = 3;
00414             <span class="keywordflow">if</span>(0 == prepareReader())
00415             {
00416                 rc = 4;
00417                 <span class="keywordflow">if</span>(0 == startAndMonitorOperation())
00418                 {
00419                     rc = 0;
00420                 }
00421             }
00422 
00423             <span class="comment">/*</span>
00424 <span class="comment">             * After we're done, try to leave the reader</span>
00425 <span class="comment">             * in a clean state for next use. This is best</span>
00426 <span class="comment">             * effort and no checking of the result is done.</span>
00427 <span class="comment">             */</span>
00428             <span class="keywordflow">if</span>(m_Verbose)
00429             {
00430                 printf(<span class="stringliteral">"INFO: Clean up reader configuration...\n"</span>);
00431             }
00432             scrubConfiguration();
00433         }
00434     }
00435 
00436     <span class="keywordflow">if</span>(m_Verbose)
00437     {
00438         printf (<span class="stringliteral">"INFO: Finished\n"</span>);
00439     }
00440 
00441     <span class="comment">/*</span>
00442 <span class="comment">     * Close the connection and release its resources</span>
00443 <span class="comment">     */</span>
00444     pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a4">closeConnectionToReader</a>();
00445     <span class="keyword">delete</span> pConn;
00446 
00447     <span class="comment">/*</span>
00448 <span class="comment">     * Done with the registry.</span>
00449 <span class="comment">     */</span>
00450     <span class="keyword">delete</span> pTypeRegistry;
00451 
00452     <span class="comment">/*</span>
00453 <span class="comment">     * Maybe tattle on the number of tags. Normally tags are reported.</span>
00454 <span class="comment">     * The -q command option prevents that and instead asks for just a</span>
00455 <span class="comment">     * total. With the -v command option we're probably reporting tags</span>
00456 <span class="comment">     * and a final count.</span>
00457 <span class="comment">     */</span>
00458     <span class="keywordflow">if</span>(m_Verbose || m_Quiet)
00459     {
00460         printf(<span class="stringliteral">"INFO: %d Tag reports\n"</span>, m_nTagReport);
00461     }
00462 
00463     <span class="comment">/*</span>
00464 <span class="comment">     * When we get here all allocated memory should have been deallocated.</span>
00465 <span class="comment">     */</span>
00466 
00467     <span class="keywordflow">return</span> rc;
00468 }
00469 
00470 
00501 <span class="keywordtype">int</span>
00502 CMyApplication::checkConnectionStatus (<span class="keywordtype">void</span>)
00503 {
00504     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pMessage;
00505     <a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *pNtf;
00506     <a class="code" href="classLLRP_1_1CReaderEventNotificationData.html">CReaderEventNotificationData</a> *pNtfData;
00507     <a class="code" href="classLLRP_1_1CConnectionAttemptEvent.html">CConnectionAttemptEvent</a> *   pEvent;
00508 
00509     <span class="comment">/*</span>
00510 <span class="comment">     * Expect the notification within 10 seconds.</span>
00511 <span class="comment">     * It is suppose to be the very first message sent.</span>
00512 <span class="comment">     */</span>
00513     pMessage = recvMessage(10000);
00514 
00515     <span class="comment">/*</span>
00516 <span class="comment">     * recvMessage() returns NULL if something went wrong.</span>
00517 <span class="comment">     */</span>
00518     <span class="keywordflow">if</span>(NULL == pMessage)
00519     {
00520         <span class="comment">/* recvMessage already tattled */</span>
00521         <span class="keywordflow">goto</span> fail;
00522     }
00523 
00524     <span class="comment">/*</span>
00525 <span class="comment">     * Check to make sure the message is of the right type.</span>
00526 <span class="comment">     * The type label (pointer) in the message should be</span>
00527 <span class="comment">     * the type descriptor for READER_EVENT_NOTIFICATION.</span>
00528 <span class="comment">     */</span>
00529     <span class="keywordflow">if</span>(&amp;CREADER_EVENT_NOTIFICATION::s_typeDescriptor != pMessage-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>)
00530     {
00531         <span class="keywordflow">goto</span> fail;
00532     }
00533 
00534     <span class="comment">/*</span>
00535 <span class="comment">     * Now that we are sure it is a READER_EVENT_NOTIFICATION,</span>
00536 <span class="comment">     * traverse to the ReaderEventNotificationData parameter.</span>
00537 <span class="comment">     */</span>
00538     pNtf = (<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *) pMessage;
00539     pNtfData = pNtf-&gt;<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html#a2">getReaderEventNotificationData</a>();
00540     <span class="keywordflow">if</span>(NULL == pNtfData)
00541     {
00542         <span class="keywordflow">goto</span> fail;
00543     }
00544 
00545     <span class="comment">/*</span>
00546 <span class="comment">     * The ConnectionAttemptEvent parameter must be present.</span>
00547 <span class="comment">     */</span>
00548     pEvent = pNtfData-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationData.html#a22">getConnectionAttemptEvent</a>();
00549     <span class="keywordflow">if</span>(NULL == pEvent)
00550     {
00551         <span class="keywordflow">goto</span> fail;
00552     }
00553 
00554     <span class="comment">/*</span>
00555 <span class="comment">     * The status in the ConnectionAttemptEvent parameter</span>
00556 <span class="comment">     * must indicate connection success.</span>
00557 <span class="comment">     */</span>
00558     <span class="keywordflow">if</span>(<a class="code" href="namespaceLLRP.html#a313a125">ConnectionAttemptStatusType_Success</a> != pEvent-&gt;<a class="code" href="classLLRP_1_1CConnectionAttemptEvent.html#a2">getStatus</a>())
00559     {
00560         <span class="keywordflow">goto</span> fail;
00561     }
00562 
00563     <span class="comment">/*</span>
00564 <span class="comment">     * Done with the message</span>
00565 <span class="comment">     */</span>
00566     <span class="keyword">delete</span> pMessage;
00567 
00568     <span class="keywordflow">if</span>(m_Verbose)
00569     {
00570         printf(<span class="stringliteral">"INFO: Connection status OK\n"</span>);
00571     }
00572 
00573     <span class="comment">/*</span>
00574 <span class="comment">     * Victory.</span>
00575 <span class="comment">     */</span>
00576     <span class="keywordflow">return</span> 0;
00577 
00578   fail:
00579     <span class="comment">/*</span>
00580 <span class="comment">     * Something went wrong. Tattle. Clean up. Return error.</span>
00581 <span class="comment">     */</span>
00582     printf(<span class="stringliteral">"ERROR: checkConnectionStatus failed\n"</span>);
00583     <span class="keyword">delete</span> pMessage;
00584     <span class="keywordflow">return</span> -1;
00585 }
00586 
00587 
00611 <span class="keywordtype">int</span>
00612 CMyApplication::scrubConfiguration (<span class="keywordtype">void</span>)
00613 {
00614     <span class="keywordflow">if</span>(0 != resetConfigurationToFactoryDefaults())
00615     {
00616         <span class="keywordflow">return</span> -1;
00617     }
00618 
00619     <span class="keywordflow">if</span>(0 != deleteAllROSpecs())
00620     {
00621         <span class="keywordflow">return</span> -2;
00622     }
00623 
00624     <span class="keywordflow">if</span>(0 != deleteAllAccessSpecs())
00625     {
00626         <span class="keywordflow">return</span> -3;
00627     }
00628 
00629     <span class="keywordflow">return</span> 0;
00630 }
00631 
00632 
00653 <span class="keywordtype">int</span>
00654 CMyApplication::resetConfigurationToFactoryDefaults (<span class="keywordtype">void</span>)
00655 {
00656     <a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html">CSET_READER_CONFIG</a> *        pCmd;
00657     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00658     <a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html">CSET_READER_CONFIG_RESPONSE</a> *pRsp;
00659 
00660     <span class="comment">/*</span>
00661 <span class="comment">     * Compose the command message</span>
00662 <span class="comment">     */</span>
00663     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html">CSET_READER_CONFIG</a>();
00664     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(101);
00665     pCmd-&gt;<a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html#a3">setResetToFactoryDefault</a>(1);
00666 
00667     <span class="comment">/*</span>
00668 <span class="comment">     * Send the message, expect the response of certain type</span>
00669 <span class="comment">     */</span>
00670     pRspMsg = transact(pCmd);
00671 
00672     <span class="comment">/*</span>
00673 <span class="comment">     * Done with the command message</span>
00674 <span class="comment">     */</span>
00675     <span class="keyword">delete</span> pCmd;
00676 
00677     <span class="comment">/*</span>
00678 <span class="comment">     * transact() returns NULL if something went wrong.</span>
00679 <span class="comment">     */</span>
00680     <span class="keywordflow">if</span>(NULL == pRspMsg)
00681     {
00682         <span class="comment">/* transact already tattled */</span>
00683         <span class="keywordflow">return</span> -1;
00684     }
00685 
00686     <span class="comment">/*</span>
00687 <span class="comment">     * Cast to a SET_READER_CONFIG_RESPONSE message.</span>
00688 <span class="comment">     */</span>
00689     pRsp = (<a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html">CSET_READER_CONFIG_RESPONSE</a> *) pRspMsg;
00690 
00691     <span class="comment">/*</span>
00692 <span class="comment">     * Check the LLRPStatus parameter.</span>
00693 <span class="comment">     */</span>
00694     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html#a2">getLLRPStatus</a>(),
00695                         <span class="stringliteral">"resetConfigurationToFactoryDefaults"</span>))
00696     {
00697         <span class="comment">/* checkLLRPStatus already tattled */</span>
00698         <span class="keyword">delete</span> pRspMsg;
00699         <span class="keywordflow">return</span> -1;
00700     }
00701 
00702     <span class="comment">/*</span>
00703 <span class="comment">     * Done with the response message.</span>
00704 <span class="comment">     */</span>
00705     <span class="keyword">delete</span> pRspMsg;
00706 
00707     <span class="comment">/*</span>
00708 <span class="comment">     * Tattle progress, maybe</span>
00709 <span class="comment">     */</span>
00710     <span class="keywordflow">if</span>(m_Verbose)
00711     {
00712         printf(<span class="stringliteral">"INFO: Configuration reset to factory defaults\n"</span>);
00713     }
00714 
00715     <span class="comment">/*</span>
00716 <span class="comment">     * Victory.</span>
00717 <span class="comment">     */</span>
00718     <span class="keywordflow">return</span> 0;
00719 }
00720 
00721 
00741 <span class="keywordtype">int</span>
00742 CMyApplication::deleteAllROSpecs (<span class="keywordtype">void</span>)
00743 {
00744     <a class="code" href="classLLRP_1_1CDELETE__ROSPEC.html">CDELETE_ROSPEC</a> *            pCmd;
00745     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00746     <a class="code" href="classLLRP_1_1CDELETE__ROSPEC__RESPONSE.html">CDELETE_ROSPEC_RESPONSE</a> *   pRsp;
00747 
00748     <span class="comment">/*</span>
00749 <span class="comment">     * Compose the command message</span>
00750 <span class="comment">     */</span>
00751     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CDELETE__ROSPEC.html">CDELETE_ROSPEC</a>();
00752     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(102);
00753     pCmd-&gt;<a class="code" href="classLLRP_1_1CDELETE__ROSPEC.html#a3">setROSpecID</a>(0);               <span class="comment">/* All */</span>
00754 
00755     <span class="comment">/*</span>
00756 <span class="comment">     * Send the message, expect the response of certain type</span>
00757 <span class="comment">     */</span>
00758     pRspMsg = transact(pCmd);
00759 
00760     <span class="comment">/*</span>
00761 <span class="comment">     * Done with the command message</span>
00762 <span class="comment">     */</span>
00763     <span class="keyword">delete</span> pCmd;
00764 
00765     <span class="comment">/*</span>
00766 <span class="comment">     * transact() returns NULL if something went wrong.</span>
00767 <span class="comment">     */</span>
00768     <span class="keywordflow">if</span>(NULL == pRspMsg)
00769     {
00770         <span class="comment">/* transact already tattled */</span>
00771         <span class="keywordflow">return</span> -1;
00772     }
00773 
00774     <span class="comment">/*</span>
00775 <span class="comment">     * Cast to a DELETE_ROSPEC_RESPONSE message.</span>
00776 <span class="comment">     */</span>
00777     pRsp = (<a class="code" href="classLLRP_1_1CDELETE__ROSPEC__RESPONSE.html">CDELETE_ROSPEC_RESPONSE</a> *) pRspMsg;
00778 
00779     <span class="comment">/*</span>
00780 <span class="comment">     * Check the LLRPStatus parameter.</span>
00781 <span class="comment">     */</span>
00782     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CDELETE__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"deleteAllROSpecs"</span>))
00783     {
00784         <span class="comment">/* checkLLRPStatus already tattled */</span>
00785         <span class="keyword">delete</span> pRspMsg;
00786         <span class="keywordflow">return</span> -1;
00787     }
00788 
00789     <span class="comment">/*</span>
00790 <span class="comment">     * Done with the response message.</span>
00791 <span class="comment">     */</span>
00792     <span class="keyword">delete</span> pRspMsg;
00793 
00794     <span class="comment">/*</span>
00795 <span class="comment">     * Tattle progress, maybe</span>
00796 <span class="comment">     */</span>
00797     <span class="keywordflow">if</span>(m_Verbose)
00798     {
00799         printf(<span class="stringliteral">"INFO: All ROSpecs are deleted\n"</span>);
00800     }
00801 
00802     <span class="comment">/*</span>
00803 <span class="comment">     * Victory.</span>
00804 <span class="comment">     */</span>
00805     <span class="keywordflow">return</span> 0;
00806 }
00807 
00808 
00828 <span class="keywordtype">int</span>
00829 CMyApplication::deleteAllAccessSpecs (<span class="keywordtype">void</span>)
00830 {
00831     <a class="code" href="classLLRP_1_1CDELETE__ACCESSSPEC.html">CDELETE_ACCESSSPEC</a> *        pCmd;
00832     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00833     <a class="code" href="classLLRP_1_1CDELETE__ACCESSSPEC__RESPONSE.html">CDELETE_ACCESSSPEC_RESPONSE</a> *pRsp;
00834 
00835     <span class="comment">/*</span>
00836 <span class="comment">     * Compose the command message</span>
00837 <span class="comment">     */</span>
00838     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CDELETE__ACCESSSPEC.html">CDELETE_ACCESSSPEC</a>();
00839     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(103);
00840     pCmd-&gt;<a class="code" href="classLLRP_1_1CDELETE__ACCESSSPEC.html#a3">setAccessSpecID</a>(0);           <span class="comment">/* All */</span>
00841 
00842     <span class="comment">/*</span>
00843 <span class="comment">     * Send the message, expect the response of certain type</span>
00844 <span class="comment">     */</span>
00845     pRspMsg = transact(pCmd);
00846 
00847     <span class="comment">/*</span>
00848 <span class="comment">     * Done with the command message</span>
00849 <span class="comment">     */</span>
00850     <span class="keyword">delete</span> pCmd;
00851 
00852     <span class="comment">/*</span>
00853 <span class="comment">     * transact() returns NULL if something went wrong.</span>
00854 <span class="comment">     */</span>
00855     <span class="keywordflow">if</span>(NULL == pRspMsg)
00856     {
00857         <span class="comment">/* transact already tattled */</span>
00858         <span class="keywordflow">return</span> -1;
00859     }
00860 
00861     <span class="comment">/*</span>
00862 <span class="comment">     * Cast to a DELETE_ACCESSSPEC_RESPONSE message.</span>
00863 <span class="comment">     */</span>
00864     pRsp = (<a class="code" href="classLLRP_1_1CDELETE__ACCESSSPEC__RESPONSE.html">CDELETE_ACCESSSPEC_RESPONSE</a> *) pRspMsg;
00865 
00866     <span class="comment">/*</span>
00867 <span class="comment">     * Check the LLRPStatus parameter.</span>
00868 <span class="comment">     */</span>
00869     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CDELETE__ACCESSSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"deleteAllAccessSpecs"</span>))
00870     {
00871         <span class="comment">/* checkLLRPStatus already tattled */</span>
00872         <span class="keyword">delete</span> pRspMsg;
00873         <span class="keywordflow">return</span> -1;
00874     }
00875 
00876     <span class="comment">/*</span>
00877 <span class="comment">     * Done with the response message.</span>
00878 <span class="comment">     */</span>
00879     <span class="keyword">delete</span> pRspMsg;
00880 
00881     <span class="comment">/*</span>
00882 <span class="comment">     * Tattle progress, maybe</span>
00883 <span class="comment">     */</span>
00884     <span class="keywordflow">if</span>(m_Verbose)
00885     {
00886         printf(<span class="stringliteral">"INFO: All AccessSpecs are deleted\n"</span>);
00887     }
00888 
00889     <span class="comment">/*</span>
00890 <span class="comment">     * Victory.</span>
00891 <span class="comment">     */</span>
00892     <span class="keywordflow">return</span> 0;
00893 }
00894 
00895 
00924 <span class="keywordtype">int</span>
00925 CMyApplication::prepareReader(<span class="keywordtype">void</span>)
00926 {
00927     <span class="keywordflow">if</span>(0 != getAllCapabilities())
00928     {
00929         <span class="keywordflow">return</span> -1;
00930     }
00931 
00932     <span class="keywordflow">if</span>(0 != getAllConfiguration())
00933     {
00934         <span class="keywordflow">return</span> -2;
00935     }
00936 
00937     <span class="keywordflow">if</span>(0 != configureNotificationStates())
00938     {
00939         <span class="keywordflow">return</span> -3;
00940     }
00941 
00942     <span class="keywordflow">if</span>(0 != getAllConfiguration())
00943     {
00944         <span class="keywordflow">return</span> -4;
00945     }
00946 
00947     <span class="keywordflow">if</span>(0 != addROSpec())
00948     {
00949         <span class="keywordflow">return</span> -5;
00950     }
00951 
00952     <span class="keywordflow">if</span>(0 != enableROSpec())
00953     {
00954         <span class="keywordflow">return</span> -6;
00955     }
00956 
00957     <span class="keywordflow">return</span> 0;
00958 }
00959 
00960 
00983 <span class="keywordtype">int</span>
00984 CMyApplication::getAllCapabilities (<span class="keywordtype">void</span>)
00985 {
00986     <a class="code" href="classLLRP_1_1CGET__READER__CAPABILITIES.html">CGET_READER_CAPABILITIES</a> *  pCmd;
00987     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00988     <a class="code" href="classLLRP_1_1CGET__READER__CAPABILITIES__RESPONSE.html">CGET_READER_CAPABILITIES_RESPONSE</a> *pRsp;
00989 
00990     <span class="comment">/*</span>
00991 <span class="comment">     * Compose the command message</span>
00992 <span class="comment">     */</span>
00993     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CGET__READER__CAPABILITIES.html">CGET_READER_CAPABILITIES</a>();
00994     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(120);
00995     pCmd-&gt;<a class="code" href="classLLRP_1_1CGET__READER__CAPABILITIES.html#a3">setRequestedData</a>(GetReaderCapabilitiesRequestedData_All);
00996 
00997     <span class="comment">/*</span>
00998 <span class="comment">     * Send the message, expect the response of certain type</span>
00999 <span class="comment">     */</span>
01000     pRspMsg = transact(pCmd);
01001 
01002     <span class="comment">/*</span>
01003 <span class="comment">     * Done with the command message</span>
01004 <span class="comment">     */</span>
01005     <span class="keyword">delete</span> pCmd;
01006 
01007     <span class="comment">/*</span>
01008 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01009 <span class="comment">     */</span>
01010     <span class="keywordflow">if</span>(NULL == pRspMsg)
01011     {
01012         <span class="comment">/* transact already tattled */</span>
01013         <span class="keywordflow">return</span> -1;
01014     }
01015 
01016     <span class="comment">/*</span>
01017 <span class="comment">     * Cast to a GET_READER_CAPABILITIES_RESPONSE message.</span>
01018 <span class="comment">     */</span>
01019     pRsp = (<a class="code" href="classLLRP_1_1CGET__READER__CAPABILITIES__RESPONSE.html">CGET_READER_CAPABILITIES_RESPONSE</a> *) pRspMsg;
01020 
01021     <span class="comment">/*</span>
01022 <span class="comment">     * Check the LLRPStatus parameter.</span>
01023 <span class="comment">     */</span>
01024     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CGET__READER__CAPABILITIES__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"getAllCapabilities"</span>))
01025     {
01026         <span class="comment">/* checkLLRPStatus already tattled */</span>
01027         <span class="keyword">delete</span> pRspMsg;
01028         <span class="keywordflow">return</span> -1;
01029     }
01030 
01031     <span class="comment">/*</span>
01032 <span class="comment">     * Done with the response message.</span>
01033 <span class="comment">     */</span>
01034     <span class="keyword">delete</span> pRspMsg;
01035 
01036     <span class="comment">/*</span>
01037 <span class="comment">     * Tattle progress, maybe</span>
01038 <span class="comment">     */</span>
01039     <span class="keywordflow">if</span>(m_Verbose)
01040     {
01041         printf(<span class="stringliteral">"INFO: Got capabilities\n"</span>);
01042     }
01043 
01044     <span class="comment">/*</span>
01045 <span class="comment">     * Victory.</span>
01046 <span class="comment">     */</span>
01047     <span class="keywordflow">return</span> 0;
01048 }
01049 
01050 
01073 <span class="keywordtype">int</span>
01074 CMyApplication::getAllConfiguration (<span class="keywordtype">void</span>)
01075 {
01076     <a class="code" href="classLLRP_1_1CGET__READER__CONFIG.html">CGET_READER_CONFIG</a> *        pCmd;
01077     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
01078     <a class="code" href="classLLRP_1_1CGET__READER__CONFIG__RESPONSE.html">CGET_READER_CONFIG_RESPONSE</a> *pRsp;
01079 
01080     <span class="comment">/*</span>
01081 <span class="comment">     * Compose the command message</span>
01082 <span class="comment">     */</span>
01083     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CGET__READER__CONFIG.html">CGET_READER_CONFIG</a>();
01084     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(121);
01085     pCmd-&gt;<a class="code" href="classLLRP_1_1CGET__READER__CONFIG.html#a5">setRequestedData</a>(GetReaderConfigRequestedData_All);
01086 
01087     <span class="comment">/*</span>
01088 <span class="comment">     * Send the message, expect the response of certain type</span>
01089 <span class="comment">     */</span>
01090     pRspMsg = transact(pCmd);
01091 
01092     <span class="comment">/*</span>
01093 <span class="comment">     * Done with the command message</span>
01094 <span class="comment">     */</span>
01095     <span class="keyword">delete</span> pCmd;
01096 
01097     <span class="comment">/*</span>
01098 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01099 <span class="comment">     */</span>
01100     <span class="keywordflow">if</span>(NULL == pRspMsg)
01101     {
01102         <span class="comment">/* transact already tattled */</span>
01103         <span class="keywordflow">return</span> -1;
01104     }
01105 
01106     <span class="comment">/*</span>
01107 <span class="comment">     * Cast to a GET_READER_CONFIG_RESPONSE message.</span>
01108 <span class="comment">     */</span>
01109     pRsp = (<a class="code" href="classLLRP_1_1CGET__READER__CONFIG__RESPONSE.html">CGET_READER_CONFIG_RESPONSE</a> *) pRspMsg;
01110 
01111     <span class="comment">/*</span>
01112 <span class="comment">     * Check the LLRPStatus parameter.</span>
01113 <span class="comment">     */</span>
01114     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CGET__READER__CONFIG__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"getAllConfiguration"</span>))
01115     {
01116         <span class="comment">/* checkLLRPStatus already tattled */</span>
01117         <span class="keyword">delete</span> pRspMsg;
01118         <span class="keywordflow">return</span> -1;
01119     }
01120 
01121     <span class="comment">/*</span>
01122 <span class="comment">     * Done with the response message.</span>
01123 <span class="comment">     */</span>
01124     <span class="keyword">delete</span> pRspMsg;
01125 
01126     <span class="comment">/*</span>
01127 <span class="comment">     * Tattle progress, maybe</span>
01128 <span class="comment">     */</span>
01129     <span class="keywordflow">if</span>(m_Verbose)
01130     {
01131         printf(<span class="stringliteral">"INFO: Got configuration\n"</span>);
01132     }
01133 
01134     <span class="comment">/*</span>
01135 <span class="comment">     * Victory.</span>
01136 <span class="comment">     */</span>
01137     <span class="keywordflow">return</span> 0;
01138 }
01139 
01140 
01205 <span class="keywordtype">int</span>
01206 CMyApplication::configureNotificationStates (<span class="keywordtype">void</span>)
01207 {
01208     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENHop = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01209     pENHop-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_Upon_Hopping_To_Next_Channel);
01210     pENHop-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(TRUE);
01211 
01212     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENGPI = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01213     pENGPI-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_GPI_Event);
01214     pENGPI-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(FALSE);
01215 
01216     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENROSpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01217     pENROSpec-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_ROSpec_Event);
01218     pENROSpec-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(TRUE);
01219 
01220     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENBufWarn = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01221     pENBufWarn-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_Report_Buffer_Fill_Warning);
01222     pENBufWarn-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(TRUE);
01223 
01224     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENExcept = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01225     pENExcept-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_Reader_Exception_Event);
01226     pENExcept-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(TRUE);
01227 
01228     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENSurvey = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01229     pENSurvey-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_RFSurvey_Event);
01230     pENSurvey-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(FALSE);
01231 
01232     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENAISpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01233     pENAISpec-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_AISpec_Event);
01234     pENAISpec-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(TRUE);
01235 
01236     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENAISpecDetails
01237                                     = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01238     pENAISpecDetails-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(
01239             NotificationEventType_AISpec_Event_With_Details);
01240     pENAISpecDetails-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(FALSE);
01241 
01242     <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a> *   pENAnt = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CEventNotificationState.html">CEventNotificationState</a>();
01243     pENAnt-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a3">setEventType</a>(NotificationEventType_Antenna_Event);
01244     pENAnt-&gt;<a class="code" href="classLLRP_1_1CEventNotificationState.html#a5">setNotificationState</a>(TRUE);
01245 
01246     <a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html">CReaderEventNotificationSpec</a> * pReaderEventNotificationSpec;
01247 
01248     pReaderEventNotificationSpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html">CReaderEventNotificationSpec</a>;
01249 
01250     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENHop);
01251     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENGPI);
01252     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENROSpec);
01253     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENBufWarn);
01254     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENExcept);
01255     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENSurvey);
01256     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENAISpec);
01257     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(
01258                 pENAISpecDetails);
01259     pReaderEventNotificationSpec-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationSpec.html#a6">addEventNotificationState</a>(pENAnt);
01260 
01261     <a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html">CSET_READER_CONFIG</a> *        pCmd;
01262     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
01263     <a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html">CSET_READER_CONFIG_RESPONSE</a> *pRsp;
01264 
01265     <span class="comment">/*</span>
01266 <span class="comment">     * Compose the command message.</span>
01267 <span class="comment">     * N.B.: After the message is composed, all the parameters</span>
01268 <span class="comment">     *       constructed, immediately above, are considered "owned"</span>
01269 <span class="comment">     *       by the command message. When it is destructed so</span>
01270 <span class="comment">     *       too will the parameters be.</span>
01271 <span class="comment">     */</span>
01272     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html">CSET_READER_CONFIG</a>();
01273     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(150);
01274     pCmd-&gt;<a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html#a5">setReaderEventNotificationSpec</a>(pReaderEventNotificationSpec);
01275 
01276     <span class="comment">/*</span>
01277 <span class="comment">     * Send the message, expect the response of certain type</span>
01278 <span class="comment">     */</span>
01279     pRspMsg = transact(pCmd);
01280 
01281     <span class="comment">/*</span>
01282 <span class="comment">     * Done with the command message.</span>
01283 <span class="comment">     * N.B.: And the parameters</span>
01284 <span class="comment">     */</span>
01285     <span class="keyword">delete</span> pCmd;
01286 
01287     <span class="comment">/*</span>
01288 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01289 <span class="comment">     */</span>
01290     <span class="keywordflow">if</span>(NULL == pRspMsg)
01291     {
01292         <span class="comment">/* transact already tattled */</span>
01293         <span class="keywordflow">return</span> -1;
01294     }
01295 
01296     <span class="comment">/*</span>
01297 <span class="comment">     * Cast to a SET_READER_CONFIG_RESPONSE message.</span>
01298 <span class="comment">     */</span>
01299     pRsp = (<a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html">CSET_READER_CONFIG_RESPONSE</a> *) pRspMsg;
01300 
01301     <span class="comment">/*</span>
01302 <span class="comment">     * Check the LLRPStatus parameter.</span>
01303 <span class="comment">     */</span>
01304     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html#a2">getLLRPStatus</a>(),
01305                     <span class="stringliteral">"configureNotificationStates"</span>))
01306     {
01307         <span class="keyword">delete</span> pRspMsg;
01308         <span class="keywordflow">return</span> -1;
01309     }
01310 
01311     <span class="comment">/*</span>
01312 <span class="comment">     * Done with the response message.</span>
01313 <span class="comment">     */</span>
01314     <span class="keyword">delete</span> pRspMsg;
01315 
01316     <span class="comment">/*</span>
01317 <span class="comment">     * Tattle progress, maybe</span>
01318 <span class="comment">     */</span>
01319     <span class="keywordflow">if</span>(m_Verbose)
01320     {
01321         printf(<span class="stringliteral">"INFO: Notifications are configured\n"</span>);
01322     }
01323 
01324     <span class="comment">/*</span>
01325 <span class="comment">     * Victory.</span>
01326 <span class="comment">     */</span>
01327     <span class="keywordflow">return</span> 0;
01328 }
01329 
01330 
01421 <span class="keywordtype">int</span>
01422 CMyApplication::addROSpec (<span class="keywordtype">void</span>)
01423 {
01424     <a class="code" href="classLLRP_1_1CROSpecStartTrigger.html">CROSpecStartTrigger</a> *       pROSpecStartTrigger =
01425                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROSpecStartTrigger.html">CROSpecStartTrigger</a>();
01426     pROSpecStartTrigger-&gt;<a class="code" href="classLLRP_1_1CROSpecStartTrigger.html#a3">setROSpecStartTriggerType</a>(
01427                                 ROSpecStartTriggerType_Null);
01428 
01429     <a class="code" href="classLLRP_1_1CROSpecStopTrigger.html">CROSpecStopTrigger</a> *        pROSpecStopTrigger = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROSpecStopTrigger.html">CROSpecStopTrigger</a>();
01430     pROSpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CROSpecStopTrigger.html#a3">setROSpecStopTriggerType</a>(ROSpecStopTriggerType_Null);
01431     pROSpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CROSpecStopTrigger.html#a5">setDurationTriggerValue</a>(0);     <span class="comment">/* n/a */</span>
01432 
01433     <a class="code" href="classLLRP_1_1CROBoundarySpec.html">CROBoundarySpec</a> *           pROBoundarySpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROBoundarySpec.html">CROBoundarySpec</a>();
01434     pROBoundarySpec-&gt;<a class="code" href="classLLRP_1_1CROBoundarySpec.html#a3">setROSpecStartTrigger</a>(pROSpecStartTrigger);
01435     pROBoundarySpec-&gt;<a class="code" href="classLLRP_1_1CROBoundarySpec.html#a5">setROSpecStopTrigger</a>(pROSpecStopTrigger);
01436 
01437 <span class="preprocessor">#if 1</span>
01438 <span class="preprocessor"></span>    <a class="code" href="classLLRP_1_1CAISpecStopTrigger.html">CAISpecStopTrigger</a> *        pAISpecStopTrigger = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CAISpecStopTrigger.html">CAISpecStopTrigger</a>();
01439     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a3">setAISpecStopTriggerType</a>(
01440                             AISpecStopTriggerType_Duration);
01441     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a5">setDurationTrigger</a>(30000);
01442 <span class="preprocessor">#else</span>
01443 <span class="preprocessor"></span>    <a class="code" href="classLLRP_1_1CTagObservationTrigger.html">CTagObservationTrigger</a> *    pTagObservationTrigger =
01444                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CTagObservationTrigger.html">CTagObservationTrigger</a>();
01445     pTagObservationTrigger-&gt;<a class="code" href="classLLRP_1_1CTagObservationTrigger.html#a3">setTriggerType</a> (
01446  TagObservationTriggerType_Upon_Seeing_No_More_New_Tags_For_Tms_Or_Timeout);
01447     pTagObservationTrigger-&gt;<a class="code" href="classLLRP_1_1CTagObservationTrigger.html#a5">setNumberOfTags</a>(0);         <span class="comment">/* unlimited */</span>
01448     pTagObservationTrigger-&gt;<a class="code" href="classLLRP_1_1CTagObservationTrigger.html#a7">setNumberOfAttempts</a>(0);     <span class="comment">/* n/a */</span>
01449     pTagObservationTrigger-&gt;<a class="code" href="classLLRP_1_1CTagObservationTrigger.html#a9">setT</a>(3500);                 <span class="comment">/* 3.5 sec */</span>
01450     pTagObservationTrigger-&gt;<a class="code" href="classLLRP_1_1CTagObservationTrigger.html#a11">setTimeout</a>(12500);          <span class="comment">/* 12.5 sec */</span>
01451 
01452     <a class="code" href="classLLRP_1_1CAISpecStopTrigger.html">CAISpecStopTrigger</a> *        pAISpecStopTrigger = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CAISpecStopTrigger.html">CAISpecStopTrigger</a>();
01453     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a3">setAISpecStopTriggerType</a>(
01454                             AISpecStopTriggerType_Tag_Observation);
01455     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a5">setDurationTrigger</a>(0);
01456     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a9">setTagObservationTrigger</a>(pTagObservationTrigger);
01457 <span class="preprocessor">#endif</span>
01458 <span class="preprocessor"></span>
01459     <a class="code" href="classLLRP_1_1CC1G2SingulationControl.html">CC1G2SingulationControl</a> *   pC1G2SingulationControl =
01460                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CC1G2SingulationControl.html">CC1G2SingulationControl</a>();
01461     pC1G2SingulationControl-&gt;<a class="code" href="classLLRP_1_1CC1G2SingulationControl.html#a3">setSession</a>(2);
01462     pC1G2SingulationControl-&gt;<a class="code" href="classLLRP_1_1CC1G2SingulationControl.html#a5">setTagPopulation</a>(32);
01463 
01464     <a class="code" href="classLLRP_1_1CC1G2InventoryCommand.html">CC1G2InventoryCommand</a> *     pC1G2InventoryCommand =
01465                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CC1G2InventoryCommand.html">CC1G2InventoryCommand</a>();
01466     pC1G2InventoryCommand-&gt;<a class="code" href="classLLRP_1_1CC1G2InventoryCommand.html#a12">setC1G2SingulationControl</a>(
01467                                         pC1G2SingulationControl);
01468     <span class="comment">/*</span>
01469 <span class="comment">     * C1G2RFControl might be set below if a m_ModeIndex was</span>
01470 <span class="comment">     * given on the command line.</span>
01471 <span class="comment">     */</span>
01472     <a class="code" href="classLLRP_1_1CAntennaConfiguration.html">CAntennaConfiguration</a> *     pAntennaConfiguration =
01473                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CAntennaConfiguration.html">CAntennaConfiguration</a>();
01474     pAntennaConfiguration-&gt;<a class="code" href="classLLRP_1_1CAntennaConfiguration.html#a12">addAirProtocolInventoryCommandSettings</a> (
01475                                         pC1G2InventoryCommand);
01476 
01477     <a class="code" href="classLLRP_1_1CInventoryParameterSpec.html">CInventoryParameterSpec</a> *   pInventoryParameterSpec =
01478                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CInventoryParameterSpec.html">CInventoryParameterSpec</a>();
01479     pInventoryParameterSpec-&gt;<a class="code" href="classLLRP_1_1CInventoryParameterSpec.html#a3">setInventoryParameterSpecID</a>(1234);
01480     pInventoryParameterSpec-&gt;<a class="code" href="classLLRP_1_1CInventoryParameterSpec.html#a5">setProtocolID</a>(AirProtocols_EPCGlobalClass1Gen2);
01481     pInventoryParameterSpec-&gt;<a class="code" href="classLLRP_1_1CInventoryParameterSpec.html#a10">addAntennaConfiguration</a> (
01482                                         pAntennaConfiguration);
01483 
01484     <a class="code" href="classLLRP_1_1llrp__u16v__t.html">llrp_u16v_t</a>                 AntennaIDs = <a class="code" href="classLLRP_1_1llrp__u16v__t.html">llrp_u16v_t</a>(1);
01485     AntennaIDs.<a class="code" href="classLLRP_1_1llrp__u16v__t.html#o1">m_pValue</a>[0] = 0;         <span class="comment">/* All */</span>
01486 
01487     <a class="code" href="classLLRP_1_1CAISpec.html">CAISpec</a> *                   pAISpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CAISpec.html">CAISpec</a>();
01488     pAISpec-&gt;<a class="code" href="classLLRP_1_1CAISpec.html#a3">setAntennaIDs</a>(AntennaIDs);
01489     pAISpec-&gt;<a class="code" href="classLLRP_1_1CAISpec.html#a5">setAISpecStopTrigger</a>(pAISpecStopTrigger);
01490     pAISpec-&gt;<a class="code" href="classLLRP_1_1CAISpec.html#a10">addInventoryParameterSpec</a>(pInventoryParameterSpec);
01491 
01492     <a class="code" href="classLLRP_1_1CTagReportContentSelector.html">CTagReportContentSelector</a> * pTagReportContentSelector =
01493                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CTagReportContentSelector.html">CTagReportContentSelector</a>();
01494     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a3">setEnableROSpecID</a>(FALSE);
01495     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a5">setEnableSpecIndex</a>(FALSE);
01496     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a7">setEnableInventoryParameterSpecID</a>(FALSE);
01497     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a9">setEnableAntennaID</a>(TRUE);
01498     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a11">setEnableChannelIndex</a>(FALSE);
01499     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a13">setEnablePeakRSSI</a>(TRUE);
01500     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a15">setEnableFirstSeenTimestamp</a>(TRUE);
01501     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a17">setEnableLastSeenTimestamp</a>(TRUE);
01502     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a19">setEnableTagSeenCount</a>(TRUE);
01503     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a21">setEnableAccessSpecID</a>(FALSE);
01504 
01505     <a class="code" href="classLLRP_1_1CROReportSpec.html">CROReportSpec</a> *             pROReportSpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROReportSpec.html">CROReportSpec</a>();
01506     pROReportSpec-&gt;<a class="code" href="classLLRP_1_1CROReportSpec.html#a3">setROReportTrigger</a>(
01507             ROReportTriggerType_Upon_N_Tags_Or_End_Of_ROSpec);
01508     pROReportSpec-&gt;<a class="code" href="classLLRP_1_1CROReportSpec.html#a5">setN</a>(1);         <span class="comment">/* Report every singulation */</span>
01509     pROReportSpec-&gt;<a class="code" href="classLLRP_1_1CROReportSpec.html#a7">setTagReportContentSelector</a>(pTagReportContentSelector);
01510 
01511     <a class="code" href="classLLRP_1_1CROSpec.html">CROSpec</a> *                   pROSpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROSpec.html">CROSpec</a>();
01512     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a3">setROSpecID</a>(123);
01513     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a5">setPriority</a>(0);
01514     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a7">setCurrentState</a>(ROSpecState_Disabled);
01515     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a9">setROBoundarySpec</a>(pROBoundarySpec);
01516     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a14">addSpecParameter</a>(pAISpec);
01517     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a16">setROReportSpec</a>(pROReportSpec);
01518 
01519     <a class="code" href="classLLRP_1_1CADD__ROSPEC.html">CADD_ROSPEC</a> *               pCmd;
01520     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
01521     <a class="code" href="classLLRP_1_1CADD__ROSPEC__RESPONSE.html">CADD_ROSPEC_RESPONSE</a> *      pRsp;
01522 
01523     <span class="comment">/*</span>
01524 <span class="comment">     * Compose the command message.</span>
01525 <span class="comment">     * N.B.: After the message is composed, all the parameters</span>
01526 <span class="comment">     *       constructed, immediately above, are considered "owned"</span>
01527 <span class="comment">     *       by the command message. When it is destructed so</span>
01528 <span class="comment">     *       too will the parameters be.</span>
01529 <span class="comment">     */</span>
01530     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CADD__ROSPEC.html">CADD_ROSPEC</a>();
01531     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(201);
01532     pCmd-&gt;<a class="code" href="classLLRP_1_1CADD__ROSPEC.html#a3">setROSpec</a>(pROSpec);
01533 
01534     <span class="comment">/*</span>
01535 <span class="comment">     * If the mode was specified link in the AntennaConfiguration</span>
01536 <span class="comment">     * that was prepared, above. The absence of the AntennaConfiguration</span>
01537 <span class="comment">     * tells the reader to use the default mode.</span>
01538 <span class="comment">     */</span>
01539     <span class="keywordflow">if</span>(0 &lt;= m_ModeIndex)
01540     {
01541         <a class="code" href="classLLRP_1_1CC1G2RFControl.html">CC1G2RFControl</a> *        pC1G2RFControl =
01542                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CC1G2RFControl.html">CC1G2RFControl</a>();
01543 
01544         pC1G2RFControl-&gt;<a class="code" href="classLLRP_1_1CC1G2RFControl.html#a3">setModeIndex</a>(m_ModeIndex);
01545         pC1G2InventoryCommand-&gt;<a class="code" href="classLLRP_1_1CC1G2InventoryCommand.html#a10">setC1G2RFControl</a>(pC1G2RFControl);
01546     }
01547 
01548     <span class="comment">/*</span>
01549 <span class="comment">     * Send the message, expect the response of certain type</span>
01550 <span class="comment">     */</span>
01551     pRspMsg = transact(pCmd);
01552 
01553     <span class="comment">/*</span>
01554 <span class="comment">     * Done with the command message.</span>
01555 <span class="comment">     * N.B.: And the parameters</span>
01556 <span class="comment">     */</span>
01557     <span class="keyword">delete</span> pCmd;
01558 
01559     <span class="comment">/*</span>
01560 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01561 <span class="comment">     */</span>
01562     <span class="keywordflow">if</span>(NULL == pRspMsg)
01563     {
01564         <span class="comment">/* transact already tattled */</span>
01565         <span class="keywordflow">return</span> -1;
01566     }
01567 
01568     <span class="comment">/*</span>
01569 <span class="comment">     * Cast to a ADD_ROSPEC_RESPONSE message.</span>
01570 <span class="comment">     */</span>
01571     pRsp = (<a class="code" href="classLLRP_1_1CADD__ROSPEC__RESPONSE.html">CADD_ROSPEC_RESPONSE</a> *) pRspMsg;
01572 
01573     <span class="comment">/*</span>
01574 <span class="comment">     * Check the LLRPStatus parameter.</span>
01575 <span class="comment">     */</span>
01576     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CADD__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"addROSpec"</span>))
01577     {
01578         <span class="comment">/* checkLLRPStatus already tattled */</span>
01579         <span class="keyword">delete</span> pRspMsg;
01580         <span class="keywordflow">return</span> -1;
01581     }
01582 
01583     <span class="comment">/*</span>
01584 <span class="comment">     * Done with the response message.</span>
01585 <span class="comment">     */</span>
01586     <span class="keyword">delete</span> pRspMsg;
01587 
01588     <span class="comment">/*</span>
01589 <span class="comment">     * Tattle progress, maybe</span>
01590 <span class="comment">     */</span>
01591     <span class="keywordflow">if</span>(m_Verbose)
01592     {
01593         printf(<span class="stringliteral">"INFO: ROSpec added\n"</span>);
01594     }
01595 
01596     <span class="comment">/*</span>
01597 <span class="comment">     * Victory.</span>
01598 <span class="comment">     */</span>
01599     <span class="keywordflow">return</span> 0;
01600 }
01601 
01602 
01620 <span class="keywordtype">int</span>
01621 CMyApplication::enableROSpec (<span class="keywordtype">void</span>)
01622 {
01623     <a class="code" href="classLLRP_1_1CENABLE__ROSPEC.html">CENABLE_ROSPEC</a> *            pCmd;
01624     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
01625     <a class="code" href="classLLRP_1_1CENABLE__ROSPEC__RESPONSE.html">CENABLE_ROSPEC_RESPONSE</a> *   pRsp;
01626 
01627     <span class="comment">/*</span>
01628 <span class="comment">     * Compose the command message</span>
01629 <span class="comment">     */</span>
01630     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CENABLE__ROSPEC.html">CENABLE_ROSPEC</a>();
01631     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(202);
01632     pCmd-&gt;<a class="code" href="classLLRP_1_1CENABLE__ROSPEC.html#a3">setROSpecID</a>(123);
01633 
01634     <span class="comment">/*</span>
01635 <span class="comment">     * Send the message, expect the response of certain type</span>
01636 <span class="comment">     */</span>
01637     pRspMsg = transact(pCmd);
01638 
01639     <span class="comment">/*</span>
01640 <span class="comment">     * Done with the command message</span>
01641 <span class="comment">     */</span>
01642     <span class="keyword">delete</span> pCmd;
01643 
01644     <span class="comment">/*</span>
01645 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01646 <span class="comment">     */</span>
01647     <span class="keywordflow">if</span>(NULL == pRspMsg)
01648     {
01649         <span class="comment">/* transact already tattled */</span>
01650         <span class="keywordflow">return</span> -1;
01651     }
01652 
01653     <span class="comment">/*</span>
01654 <span class="comment">     * Cast to a ENABLE_ROSPEC_RESPONSE message.</span>
01655 <span class="comment">     */</span>
01656     pRsp = (<a class="code" href="classLLRP_1_1CENABLE__ROSPEC__RESPONSE.html">CENABLE_ROSPEC_RESPONSE</a> *) pRspMsg;
01657 
01658     <span class="comment">/*</span>
01659 <span class="comment">     * Check the LLRPStatus parameter.</span>
01660 <span class="comment">     */</span>
01661     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CENABLE__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"enableROSpec"</span>))
01662     {
01663         <span class="comment">/* checkLLRPStatus already tattled */</span>
01664         <span class="keyword">delete</span> pRspMsg;
01665         <span class="keywordflow">return</span> -1;
01666     }
01667 
01668     <span class="comment">/*</span>
01669 <span class="comment">     * Done with the response message.</span>
01670 <span class="comment">     */</span>
01671     <span class="keyword">delete</span> pRspMsg;
01672 
01673     <span class="comment">/*</span>
01674 <span class="comment">     * Tattle progress, maybe</span>
01675 <span class="comment">     */</span>
01676     <span class="keywordflow">if</span>(m_Verbose)
01677     {
01678         printf(<span class="stringliteral">"INFO: ROSpec enabled\n"</span>);
01679     }
01680 
01681     <span class="comment">/*</span>
01682 <span class="comment">     * Victory.</span>
01683 <span class="comment">     */</span>
01684     <span class="keywordflow">return</span> 0;
01685 }
01686 
01687 
01730 <span class="keywordtype">int</span>
01731 CMyApplication::startAndMonitorOperation (<span class="keywordtype">void</span>)
01732 {
01733     <a class="code" href="classLLRP_1_1CSTART__ROSPEC.html">CSTART_ROSPEC</a> *             pCmd;
01734     <span class="keywordtype">int</span>                         bDone = 0;
01735     <span class="keywordtype">int</span>                         RetVal = 0;
01736 
01737     <span class="comment">/*</span>
01738 <span class="comment">     * Tattle as we start.</span>
01739 <span class="comment">     */</span>
01740     printf(<span class="stringliteral">"INFO: Inventory operation starting\n"</span>);
01741 
01742     <span class="comment">/*</span>
01743 <span class="comment">     * Compose the command message</span>
01744 <span class="comment">     */</span>
01745     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CSTART__ROSPEC.html">CSTART_ROSPEC</a>();
01746     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(203);
01747     pCmd-&gt;<a class="code" href="classLLRP_1_1CSTART__ROSPEC.html#a3">setROSpecID</a>(123);
01748 
01749     <span class="comment">/*</span>
01750 <span class="comment">     * Just send the START_ROSPEC message, do not wait for the resposne.</span>
01751 <span class="comment">     */</span>
01752     <span class="keywordflow">if</span>(0 != sendMessage(pCmd))
01753     {
01754         <span class="comment">/* sendMessage already tattled */</span>
01755         <span class="keywordflow">return</span> -1;
01756     }
01757 
01758     <span class="comment">/*</span>
01759 <span class="comment">     * Done with the command message</span>
01760 <span class="comment">     */</span>
01761     <span class="keyword">delete</span> pCmd;
01762 
01763     <span class="comment">/*</span>
01764 <span class="comment">     * Keep receiving messages until done or until</span>
01765 <span class="comment">     * something bad happens.</span>
01766 <span class="comment">     */</span>
01767     <span class="keywordflow">while</span>(!bDone)
01768     {
01769         <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *              pMessage;
01770         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CTypeDescriptor.html">CTypeDescriptor</a> * pType;
01771 
01772         <span class="comment">/*</span>
01773 <span class="comment">         * Wait up to 20 seconds for a message. They should</span>
01774 <span class="comment">         * be much more frequent because there will be several</span>
01775 <span class="comment">         * hopping events per second.</span>
01776 <span class="comment">         */</span>
01777         pMessage = recvMessage(20000);
01778         <span class="keywordflow">if</span>(NULL == pMessage)
01779         {
01780             <span class="comment">/*</span>
01781 <span class="comment">             * Did not receive a message within a reasonable</span>
01782 <span class="comment">             * amount of time. recvMessage() already tattled</span>
01783 <span class="comment">             */</span>
01784             RetVal = -2;
01785             bDone = 1;
01786             <span class="keywordflow">continue</span>;
01787         }
01788 
01789         <span class="comment">/*</span>
01790 <span class="comment">         * What happens depends on what kind of message</span>
01791 <span class="comment">         * received. Use the type label (m_pType) to</span>
01792 <span class="comment">         * discriminate message types.</span>
01793 <span class="comment">         */</span>
01794         pType = pMessage-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>;
01795 
01796         <span class="comment">/*</span>
01797 <span class="comment">         * Is it the response from the START_ROSPEC?</span>
01798 <span class="comment">         * If so, just make sure the status is good.</span>
01799 <span class="comment">         * If the status is not good there is no</span>
01800 <span class="comment">         * ROSpec running and things are done.</span>
01801 <span class="comment">         */</span>
01802         <span class="keywordflow">if</span>(&amp;CSTART_ROSPEC_RESPONSE::s_typeDescriptor == pType)
01803         {
01804             <a class="code" href="classLLRP_1_1CSTART__ROSPEC__RESPONSE.html">CSTART_ROSPEC_RESPONSE</a> *pRsp;
01805 
01806             <span class="comment">/*</span>
01807 <span class="comment">             * Cast to a START_ROSPEC_RESPONSE message.</span>
01808 <span class="comment">             */</span>
01809             pRsp = (<a class="code" href="classLLRP_1_1CSTART__ROSPEC__RESPONSE.html">CSTART_ROSPEC_RESPONSE</a> *) pMessage;
01810 
01811             <span class="comment">/*</span>
01812 <span class="comment">             * Check the LLRPStatus parameter.</span>
01813 <span class="comment">             */</span>
01814             <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CSTART__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"startROSpec"</span>))
01815             {
01816                 <span class="comment">/* checkLLRPStatus already tattled */</span>
01817                 RetVal = -3;
01818                 bDone = 1;
01819             }
01820             <span class="keywordflow">else</span>
01821             {
01822                 <span class="comment">/* Good start. Tattle, maybe. */</span>
01823                 <span class="keywordflow">if</span>(m_Verbose)
01824                 {
01825                     printf(<span class="stringliteral">"INFO: Start command acknowledged\n"</span>);
01826                 }
01827             }
01828         }
01829 
01830         <span class="comment">/*</span>
01831 <span class="comment">         * Is it a reader event? If so, which ones?</span>
01832 <span class="comment">         */</span>
01833         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(&amp;CREADER_EVENT_NOTIFICATION::s_typeDescriptor == pType)
01834         {
01835             <a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *pNtf;
01836             <a class="code" href="classLLRP_1_1CReaderEventNotificationData.html">CReaderEventNotificationData</a> *pNtfData;
01837 
01838             pNtf = (<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *) pMessage;
01839             pNtfData = pNtf-&gt;<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html#a2">getReaderEventNotificationData</a>();
01840 
01841             <span class="comment">/*</span>
01842 <span class="comment">             * Is there an ROSpecEvent? These tell use when the ROSpec</span>
01843 <span class="comment">             * starts and stops. When it stops things are done.</span>
01844 <span class="comment">             */</span>
01845             <span class="keywordflow">if</span>(NULL != pNtfData-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationData.html#a8">getROSpecEvent</a>())
01846             {
01847                 <a class="code" href="classLLRP_1_1CROSpecEvent.html">CROSpecEvent</a> *    pROEvent;
01848 
01849                 pROEvent = pNtfData-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationData.html#a8">getROSpecEvent</a>();
01850                 <span class="keywordflow">switch</span>(pROEvent-&gt;<a class="code" href="classLLRP_1_1CROSpecEvent.html#a2">getEventType</a>())
01851                 {
01852                 <span class="keywordflow">default</span>:
01853                     printf(<span class="stringliteral">"ERROR: Unknown RO event type\n"</span>);
01854                     RetVal = -4;
01855                     bDone = 1;
01856                     <span class="keywordflow">break</span>;
01857 
01858                 <span class="keywordflow">case</span> <a class="code" href="namespaceLLRP.html#a309a117">ROSpecEventType_Start_Of_ROSpec</a>:
01859                     <span class="keywordflow">if</span>(m_Verbose)
01860                     {
01861                         printf(<span class="stringliteral">"INFO: RO running\n"</span>);
01862                     }
01863                     <span class="keywordflow">break</span>;
01864 
01865                 <span class="keywordflow">case</span> <a class="code" href="namespaceLLRP.html#a309a118">ROSpecEventType_End_Of_ROSpec</a>:
01866                     <span class="keywordflow">if</span>(m_Verbose)
01867                     {
01868                         printf(<span class="stringliteral">"INFO: RO stopped\n"</span>);
01869                     }
01870                     RetVal = 0;
01871                     bDone = 1;
01872                     <span class="keywordflow">break</span>;
01873                 }
01874             }
01875 
01876             <span class="comment">/*</span>
01877 <span class="comment">             * Other reader events may be present.</span>
01878 <span class="comment">             * Notifications enabled include AISpec events,</span>
01879 <span class="comment">             * antenna events, and hopping events.</span>
01880 <span class="comment">             * Run this programs with -vv to see the</span>
01881 <span class="comment">             * XML for the other events.</span>
01882 <span class="comment">             *</span>
01883 <span class="comment">             * For this example we just ignore them.</span>
01884 <span class="comment">             */</span>
01885         }
01886 
01887         <span class="comment">/*</span>
01888 <span class="comment">         * Is it a tag report? If so, print it out.</span>
01889 <span class="comment">         */</span>
01890         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(&amp;CRO_ACCESS_REPORT::s_typeDescriptor == pType)
01891         {
01892             <a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> * pNtf;
01893 
01894             pNtf = (<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> *) pMessage;
01895 
01896             printTagReportData(pNtf);
01897         }
01898 
01899         <span class="comment">/*</span>
01900 <span class="comment">         * Hmmm. Something unexpected. Just tattle and keep going.</span>
01901 <span class="comment">         */</span>
01902         <span class="keywordflow">else</span>
01903         {
01904             printf(<span class="stringliteral">"WARNING: Ignored unexpected message during monitor: %s\n"</span>,
01905                 pType-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
01906         }
01907 
01908         <span class="comment">/*</span>
01909 <span class="comment">         * Done with the received message</span>
01910 <span class="comment">         */</span>
01911         <span class="keyword">delete</span> pMessage;
01912     }
01913 
01914     <span class="comment">/*</span>
01915 <span class="comment">     * Tattle about how things turned out.</span>
01916 <span class="comment">     */</span>
01917     <span class="keywordflow">if</span>(RetVal != 0)
01918     {
01919         printf(<span class="stringliteral">"ERROR: Inventory operation terminated (%d)\n"</span>, RetVal);
01920     }
01921     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(m_Verbose)
01922     {
01923         printf(<span class="stringliteral">"INFO: Inventory operation finished\n"</span>);
01924     }
01925 
01926     <span class="keywordflow">return</span> RetVal;
01927 }
01928 
01929 
01944 <span class="keywordtype">void</span>
01945 CMyApplication::printTagReportData (
01946   <a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> *           pRO_ACCESS_REPORT)
01947 {
01948     std::list&lt;CTagReportData *&gt;::iterator Cur;
01949     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                nEntry = 0;
01950 
01951     <span class="comment">/*</span>
01952 <span class="comment">     * Count the number of tag reports.</span>
01953 <span class="comment">     */</span>
01954     m_nTagReport++;
01955 
01956     <span class="comment">/*</span>
01957 <span class="comment">     * If individual tag reports are not wanted, just return.</span>
01958 <span class="comment">     */</span>
01959     <span class="keywordflow">if</span>(m_Quiet)
01960     {
01961         <span class="keywordflow">return</span>;
01962     }
01963 
01964     <span class="comment">/*</span>
01965 <span class="comment">     * Loop through and count the number of entries</span>
01966 <span class="comment">     */</span>
01967     <span class="keywordflow">for</span> (
01968         Cur = pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a2">beginTagReportData</a>();
01969         Cur != pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a3">endTagReportData</a>();
01970         Cur++)
01971     {
01972         nEntry++;
01973     }
01974 
01975     printf(<span class="stringliteral">"INFO: %u tag report entries\n"</span>, nEntry);
01976 
01977     <span class="comment">/*</span>
01978 <span class="comment">     * Loop through again and print each entry.</span>
01979 <span class="comment">     */</span>
01980     <span class="keywordflow">for</span> (
01981         Cur = pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a2">beginTagReportData</a>();
01982         Cur != pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a3">endTagReportData</a>();
01983         Cur++)
01984     {
01985         printOneTagReportData (*Cur);
01986     }
01987 }
01988 
01989 
02003 <span class="keywordtype">void</span>
02004 CMyApplication::printOneTagReportData (
02005   <a class="code" href="classLLRP_1_1CTagReportData.html">CTagReportData</a> *              pTagReportData)
02006 {
02007     <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CTypeDescriptor.html">CTypeDescriptor</a> *     pType;
02008     <span class="keywordtype">char</span>                        aBuf[64];
02009 
02010     <span class="comment">/*</span>
02011 <span class="comment">     * Print the EPC. It could be an 96-bit EPC_96 parameter</span>
02012 <span class="comment">     * or an variable length EPCData parameter.</span>
02013 <span class="comment">     */</span>
02014 
02015     <a class="code" href="classLLRP_1_1CParameter.html">CParameter</a> *                pEPCParameter =
02016                                     pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a2">getEPCParameter</a>();
02017 
02018     <span class="keywordflow">if</span>(NULL != pEPCParameter)
02019     {
02020         <span class="keywordtype">char</span> *              p = aBuf;
02021         <a class="code" href="classLLRP_1_1llrp__u96__t.html">llrp_u96_t</a>          my_u96;
02022         <a class="code" href="classLLRP_1_1llrp__u1v__t.html">llrp_u1v_t</a>          my_u1v;
02023         llrp_u8_t *         pValue = NULL;
02024         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        n, i;
02025 
02026         pType = pEPCParameter-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>;
02027         <span class="keywordflow">if</span>(&amp;CEPC_96::s_typeDescriptor == pType)
02028         {
02029             <a class="code" href="classLLRP_1_1CEPC__96.html">CEPC_96</a>             *pEPC_96;
02030 
02031             pEPC_96 = (<a class="code" href="classLLRP_1_1CEPC__96.html">CEPC_96</a> *) pEPCParameter;
02032             my_u96 = pEPC_96-&gt;<a class="code" href="classLLRP_1_1CEPC__96.html#a2">getEPC</a>();
02033             pValue = my_u96.<a class="code" href="classLLRP_1_1llrp__u96__t.html#o0">m_aValue</a>;
02034             n = 12u;
02035         }
02036         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(&amp;CEPCData::s_typeDescriptor == pType)
02037         {
02038             <a class="code" href="classLLRP_1_1CEPCData.html">CEPCData</a> *          pEPCData;
02039 
02040             pEPCData = (<a class="code" href="classLLRP_1_1CEPCData.html">CEPCData</a> *) pEPCParameter;
02041             my_u1v = pEPCData-&gt;<a class="code" href="classLLRP_1_1CEPCData.html#a2">getEPC</a>();
02042             pValue = my_u1v.<a class="code" href="classLLRP_1_1llrp__u1v__t.html#o1">m_pValue</a>;
02043             n = (my_u1v.<a class="code" href="classLLRP_1_1llrp__u1v__t.html#o0">m_nBit</a> + 7u) / 8u;
02044         }
02045 
02046         <span class="keywordflow">if</span>(NULL != pValue)
02047         {
02048             <span class="keywordflow">for</span>(i = 0; i &lt; n; i++)
02049             {
02050                 <span class="keywordflow">if</span>(0 &lt; i &amp;&amp; i%2 == 0)
02051                 {
02052                     *p++ = <span class="charliteral">'-'</span>;
02053                 }
02054                 sprintf(p, <span class="stringliteral">"%02X"</span>, pValue[i]);
02055                 <span class="keywordflow">while</span>(*p) p++;
02056             }
02057         }
02058         <span class="keywordflow">else</span>
02059         {
02060             strcpy(aBuf, <span class="stringliteral">"---unknown-epc-data-type---"</span>);
02061         }
02062     }
02063     <span class="keywordflow">else</span>
02064     {
02065         strcpy(aBuf, <span class="stringliteral">"---missing-epc-data---"</span>);
02066     }
02067     printf(<span class="stringliteral">"%-32s"</span>, aBuf);
02068 
02069     <span class="comment">/*</span>
02070 <span class="comment">     * Print the antenna ID number</span>
02071 <span class="comment">     */</span>
02072     <span class="keywordflow">if</span>(NULL != pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a10">getAntennaID</a>())
02073     {
02074         sprintf(aBuf, <span class="stringliteral">"ant%d"</span>,
02075             pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a10">getAntennaID</a>()-&gt;<a class="code" href="classLLRP_1_1CAntennaID.html#a2">getAntennaID</a>());
02076     }
02077     <span class="keywordflow">else</span>
02078     {
02079         sprintf(aBuf, <span class="stringliteral">"ant?"</span>);
02080     }
02081     printf(<span class="stringliteral">" %-5s"</span>, aBuf);
02082 
02083     <span class="comment">/*</span>
02084 <span class="comment">     * Print the peak RSSI</span>
02085 <span class="comment">     */</span>
02086     <span class="keywordflow">if</span>(NULL != pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a12">getPeakRSSI</a>())
02087     {
02088         sprintf(aBuf, <span class="stringliteral">"%3ddBm"</span>,
02089             pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a12">getPeakRSSI</a>()-&gt;<a class="code" href="classLLRP_1_1CPeakRSSI.html#a2">getPeakRSSI</a>());
02090     }
02091     <span class="keywordflow">else</span>
02092     {
02093         sprintf(aBuf, <span class="stringliteral">"  ?dBm"</span>);
02094     }
02095     printf(<span class="stringliteral">" %-7s"</span>, aBuf);
02096 
02097     <span class="comment">/*</span>
02098 <span class="comment">     * Print the number of times the tag was seen</span>
02099 <span class="comment">     */</span>
02100     <span class="keywordflow">if</span>(NULL != pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a24">getTagSeenCount</a>())
02101     {
02102         sprintf(aBuf, <span class="stringliteral">"%4dseen"</span>,
02103             pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a24">getTagSeenCount</a>()-&gt;<a class="code" href="classLLRP_1_1CTagSeenCount.html#a2">getTagCount</a>());
02104     }
02105     <span class="keywordflow">else</span>
02106     {
02107         sprintf(aBuf, <span class="stringliteral">"   ?seen"</span>);
02108     }
02109     printf(<span class="stringliteral">" %-8s"</span>, aBuf);
02110 
02111     <span class="comment">/*</span>
02112 <span class="comment">     * End of line</span>
02113 <span class="comment">     */</span>
02114     printf(<span class="stringliteral">"\n"</span>);
02115 }
02116 
02117 
02136 <span class="keywordtype">int</span>
02137 CMyApplication::checkLLRPStatus (
02138   <a class="code" href="classLLRP_1_1CLLRPStatus.html">CLLRPStatus</a> *                 pLLRPStatus,
02139   <span class="keywordtype">char</span> *                        pWhatStr)
02140 {
02141     <span class="comment">/*</span>
02142 <span class="comment">     * The LLRPStatus parameter is mandatory in all responses.</span>
02143 <span class="comment">     * If it is missing there should have been a decode error.</span>
02144 <span class="comment">     * This just makes sure (remember, this program is a</span>
02145 <span class="comment">     * diagnostic and suppose to catch LTKC mistakes).</span>
02146 <span class="comment">     */</span>
02147     <span class="keywordflow">if</span>(NULL == pLLRPStatus)
02148     {
02149         printf(<span class="stringliteral">"ERROR: %s missing LLRP status\n"</span>, pWhatStr);
02150         <span class="keywordflow">return</span> -1;
02151     }
02152 
02153     <span class="comment">/*</span>
02154 <span class="comment">     * Make sure the status is M_Success.</span>
02155 <span class="comment">     * If it isn't, print the error string if one.</span>
02156 <span class="comment">     * This does not try to pretty-print the status</span>
02157 <span class="comment">     * code. To get that, run this program with -vv</span>
02158 <span class="comment">     * and examine the XML output.</span>
02159 <span class="comment">     */</span>
02160     <span class="keywordflow">if</span>(<a class="code" href="namespaceLLRP.html#a314a130">StatusCode_M_Success</a> != pLLRPStatus-&gt;<a class="code" href="classLLRP_1_1CLLRPStatus.html#a2">getStatusCode</a>())
02161     {
02162         <a class="code" href="classLLRP_1_1llrp__utf8v__t.html">llrp_utf8v_t</a>            ErrorDesc;
02163 
02164         ErrorDesc = pLLRPStatus-&gt;<a class="code" href="classLLRP_1_1CLLRPStatus.html#a4">getErrorDescription</a>();
02165 
02166         <span class="keywordflow">if</span>(0 == ErrorDesc.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o0">m_nValue</a>)
02167         {
02168             printf(<span class="stringliteral">"ERROR: %s failed, no error description given\n"</span>,
02169                 pWhatStr);
02170         }
02171         <span class="keywordflow">else</span>
02172         {
02173             printf(<span class="stringliteral">"ERROR: %s failed, %.*s\n"</span>,
02174                 pWhatStr, ErrorDesc.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o0">m_nValue</a>, ErrorDesc.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o1">m_pValue</a>);
02175         }
02176         <span class="keywordflow">return</span> -2;
02177     }
02178 
02179     <span class="comment">/*</span>
02180 <span class="comment">     * Victory. Everything is fine.</span>
02181 <span class="comment">     */</span>
02182     <span class="keywordflow">return</span> 0;
02183 }
02184 
02185 
02209 <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
02210 CMyApplication::transact (
02211   <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                    pSendMsg)
02212 {
02213     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn = m_pConnectionToReader;
02214     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
02215 
02216     <span class="comment">/*</span>
02217 <span class="comment">     * Print the XML text for the outbound message if</span>
02218 <span class="comment">     * verbosity is 2 or higher.</span>
02219 <span class="comment">     */</span>
02220     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
02221     {
02222         <span class="comment">/* If -qq command option, do XML encode but don't actually print */</span>
02223         <span class="keywordflow">if</span>(2 &gt; m_Quiet)
02224         {
02225             printf(<span class="stringliteral">"\n===================================\n"</span>);
02226             printf(<span class="stringliteral">"INFO: Transact sending\n"</span>);
02227         }
02228         printXMLMessage(pSendMsg);
02229     }
02230 
02231     <span class="comment">/*</span>
02232 <span class="comment">     * Send the message, expect the response of certain type.</span>
02233 <span class="comment">     * If LLRP::CConnection::transact() returns NULL then there was</span>
02234 <span class="comment">     * an error. In that case we try to print the error details.</span>
02235 <span class="comment">     */</span>
02236     pRspMsg = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a5">transact</a>(pSendMsg, 5000);
02237 
02238     <span class="keywordflow">if</span>(NULL == pRspMsg)
02239     {
02240         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CErrorDetails.html">CErrorDetails</a> *   pError = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a6">getTransactError</a>();
02241 
02242         printf(<span class="stringliteral">"ERROR: %s transact failed, %s\n"</span>,
02243             pSendMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>,
02244             pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> ? pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> : <span class="stringliteral">"no reason given"</span>);
02245 
02246         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>)
02247         {
02248             printf(<span class="stringliteral">"ERROR: ... reference type %s\n"</span>,
02249                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
02250         }
02251 
02252         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>)
02253         {
02254             printf(<span class="stringliteral">"ERROR: ... reference field %s\n"</span>,
02255                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>-&gt;<a class="code" href="classLLRP_1_1CFieldDescriptor.html#o2">m_pName</a>);
02256         }
02257 
02258         <span class="keywordflow">return</span> NULL;
02259     }
02260 
02261     <span class="comment">/*</span>
02262 <span class="comment">     * Print the XML text for the inbound message if</span>
02263 <span class="comment">     * verbosity is 2 or higher.</span>
02264 <span class="comment">     */</span>
02265     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
02266     {
02267         <span class="comment">/* If -qq command option, do XML encode but don't actually print */</span>
02268         <span class="keywordflow">if</span>(2 &gt; m_Quiet)
02269         {
02270             printf(<span class="stringliteral">"\n- - - - - - - - - - - - - - - - - -\n"</span>);
02271             printf(<span class="stringliteral">"INFO: Transact received response\n"</span>);
02272         }
02273         printXMLMessage(pRspMsg);
02274     }
02275 
02276     <span class="comment">/*</span>
02277 <span class="comment">     * If it is an ERROR_MESSAGE (response from reader</span>
02278 <span class="comment">     * when it can't understand the request), tattle</span>
02279 <span class="comment">     * and declare defeat.</span>
02280 <span class="comment">     */</span>
02281     <span class="keywordflow">if</span>(&amp;CERROR_MESSAGE::s_typeDescriptor == pRspMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>)
02282     {
02283         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CTypeDescriptor.html">CTypeDescriptor</a> * pResponseType;
02284 
02285         pResponseType = pSendMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o5">m_pResponseType</a>;
02286 
02287         printf(<span class="stringliteral">"ERROR: Received ERROR_MESSAGE instead of %s\n"</span>,
02288             pResponseType-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
02289         <span class="keyword">delete</span> pRspMsg;
02290         pRspMsg = NULL;
02291     }
02292 
02293     <span class="keywordflow">return</span> pRspMsg;
02294 }
02295 
02296 
02321 <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
02322 CMyApplication::recvMessage (
02323   <span class="keywordtype">int</span>                           nMaxMS)
02324 {
02325     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn = m_pConnectionToReader;
02326     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pMessage;
02327 
02328     <span class="comment">/*</span>
02329 <span class="comment">     * Receive the message subject to a time limit</span>
02330 <span class="comment">     */</span>
02331     pMessage = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a9">recvMessage</a>(nMaxMS);
02332 
02333     <span class="comment">/*</span>
02334 <span class="comment">     * If LLRP::CConnection::recvMessage() returns NULL then there was</span>
02335 <span class="comment">     * an error. In that case we try to print the error details.</span>
02336 <span class="comment">     */</span>
02337     <span class="keywordflow">if</span>(NULL == pMessage)
02338     {
02339         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CErrorDetails.html">CErrorDetails</a> *   pError = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a11">getRecvError</a>();
02340 
02341         printf(<span class="stringliteral">"ERROR: recvMessage failed, %s\n"</span>,
02342             pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> ? pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> : <span class="stringliteral">"no reason given"</span>);
02343 
02344         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>)
02345         {
02346             printf(<span class="stringliteral">"ERROR: ... reference type %s\n"</span>,
02347                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
02348         }
02349 
02350         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>)
02351         {
02352             printf(<span class="stringliteral">"ERROR: ... reference field %s\n"</span>,
02353                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>-&gt;<a class="code" href="classLLRP_1_1CFieldDescriptor.html#o2">m_pName</a>);
02354         }
02355 
02356         <span class="keywordflow">return</span> NULL;
02357     }
02358 
02359     <span class="comment">/*</span>
02360 <span class="comment">     * Print the XML text for the inbound message if</span>
02361 <span class="comment">     * verbosity is 2 or higher.</span>
02362 <span class="comment">     */</span>
02363     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
02364     {
02365         <span class="comment">/* If -qq command option, do XML encode but don't actually print */</span>
02366         <span class="keywordflow">if</span>(2 &gt; m_Quiet)
02367         {
02368             printf(<span class="stringliteral">"\n===================================\n"</span>);
02369             printf(<span class="stringliteral">"INFO: Message received\n"</span>);
02370         }
02371         printXMLMessage(pMessage);
02372     }
02373 
02374     <span class="keywordflow">return</span> pMessage;
02375 }
02376 
02377 
02395 <span class="keywordtype">int</span>
02396 CMyApplication::sendMessage (
02397   <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                    pSendMsg)
02398 {
02399     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn = m_pConnectionToReader;
02400 
02401     <span class="comment">/*</span>
02402 <span class="comment">     * Print the XML text for the outbound message if</span>
02403 <span class="comment">     * verbosity is 2 or higher.</span>
02404 <span class="comment">     */</span>
02405     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
02406     {
02407         <span class="comment">/* If -qq command option, do XML encode but don't actually print */</span>
02408         <span class="keywordflow">if</span>(2 &gt; m_Quiet)
02409         {
02410             printf(<span class="stringliteral">"\n===================================\n"</span>);
02411             printf(<span class="stringliteral">"INFO: Sending\n"</span>);
02412         }
02413         printXMLMessage(pSendMsg);
02414     }
02415 
02416     <span class="comment">/*</span>
02417 <span class="comment">     * If LLRP::CConnection::sendMessage() returns other than RC_OK</span>
02418 <span class="comment">     * then there was an error. In that case we try to print</span>
02419 <span class="comment">     * the error details.</span>
02420 <span class="comment">     */</span>
02421     <span class="keywordflow">if</span>(<a class="code" href="namespaceLLRP.html#a333a251">RC_OK</a> != pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a7">sendMessage</a>(pSendMsg))
02422     {
02423         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CErrorDetails.html">CErrorDetails</a> *   pError = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a8">getSendError</a>();
02424 
02425         printf(<span class="stringliteral">"ERROR: %s sendMessage failed, %s\n"</span>,
02426             pSendMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>,
02427             pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> ? pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> : <span class="stringliteral">"no reason given"</span>);
02428 
02429         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>)
02430         {
02431             printf(<span class="stringliteral">"ERROR: ... reference type %s\n"</span>,
02432                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
02433         }
02434 
02435         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>)
02436         {
02437             printf(<span class="stringliteral">"ERROR: ... reference field %s\n"</span>,
02438                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>-&gt;<a class="code" href="classLLRP_1_1CFieldDescriptor.html#o2">m_pName</a>);
02439         }
02440 
02441         <span class="keywordflow">return</span> -1;
02442     }
02443 
02444     <span class="comment">/*</span>
02445 <span class="comment">     * Victory</span>
02446 <span class="comment">     */</span>
02447     <span class="keywordflow">return</span> 0;
02448 }
02449 
02450 
02464 <span class="keywordtype">void</span>
02465 CMyApplication::printXMLMessage (
02466   <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                    pMessage)
02467 {
02468     <span class="keywordtype">char</span>                        aBuf[100*1024];
02469 
02470     <span class="comment">/*</span>
02471 <span class="comment">     * Convert the message to an XML string.</span>
02472 <span class="comment">     * This fills the buffer with either the XML string</span>
02473 <span class="comment">     * or an error message. The return value could</span>
02474 <span class="comment">     * be checked.</span>
02475 <span class="comment">     */</span>
02476 
02477     pMessage-&gt;<a class="code" href="classLLRP_1_1CElement.html#a6">toXMLString</a>(aBuf, <span class="keyword">sizeof</span> aBuf);
02478 
02479     <span class="comment">/*</span>
02480 <span class="comment">     * Print the XML Text to the standard output.</span>
02481 <span class="comment">     * For characterization, command line option -qq</span>
02482 <span class="comment">     * prevents the XML text actually being printed and</span>
02483 <span class="comment">     * so the CPU utilization of XMLTextEncoder can be measured</span>
02484 <span class="comment">     * without the noise.</span>
02485 <span class="comment">     */</span>
02486     <span class="keywordflow">if</span>(2 &gt; m_Quiet)
02487     {
02488         printf(<span class="stringliteral">"%s"</span>, aBuf);
02489     }
02490 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 24 09:16:20 2010 for LTKCPP-- LLRP Toolkit C Plus Plus Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
