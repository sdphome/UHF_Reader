<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LTKCPP-- LLRP Toolkit C Plus Plus Library: example1.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">Examples</a></div>
<h1>example1.cpp</h1><a href="example1_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> ***************************************************************************</span>
00004 <span class="comment"> *  Copyright 2007,2008 Impinj, Inc.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the "License");</span>
00007 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
00008 <span class="comment"> *  You may obtain a copy of the License at</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
00013 <span class="comment"> *  distributed under the License is distributed on an "AS IS" BASIS,</span>
00014 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
00015 <span class="comment"> *  See the License for the specific language governing permissions and</span>
00016 <span class="comment"> *  limitations under the License.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> ***************************************************************************</span>
00019 <span class="comment"> */</span>
00020 
00051 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00052 
00053 <span class="preprocessor">#include "<a class="code" href="ltkcpp_8h.html">ltkcpp.h</a>"</span>
00054 
00055 <span class="keyword">using</span> <span class="keyword">namespace </span>LLRP;
00056 
00057 
00058 <span class="keyword">class </span>CMyApplication
00059 {
00060   <span class="keyword">public</span>:
00062     <span class="keywordtype">int</span>                         m_Verbose;
00063 
00065     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               m_pConnectionToReader;
00066 
00067     <span class="keyword">inline</span>
00068     CMyApplication (<span class="keywordtype">void</span>)
00069      : m_Verbose(0), m_pConnectionToReader(NULL)
00070     {}
00071 
00072     <span class="keywordtype">int</span>
00073     run (
00074       <span class="keywordtype">char</span> *                    pReaderHostName);
00075 
00076     <span class="keywordtype">int</span>
00077     checkConnectionStatus (<span class="keywordtype">void</span>);
00078 
00079     <span class="keywordtype">int</span>
00080     scrubConfiguration (<span class="keywordtype">void</span>);
00081 
00082     <span class="keywordtype">int</span>
00083     resetConfigurationToFactoryDefaults (<span class="keywordtype">void</span>);
00084 
00085     <span class="keywordtype">int</span>
00086     deleteAllROSpecs (<span class="keywordtype">void</span>);
00087 
00088     <span class="keywordtype">int</span>
00089     addROSpec (<span class="keywordtype">void</span>);
00090 
00091     <span class="keywordtype">int</span>
00092     enableROSpec (<span class="keywordtype">void</span>);
00093 
00094     <span class="keywordtype">int</span>
00095     startROSpec (<span class="keywordtype">void</span>);
00096 
00097     <span class="keywordtype">int</span>
00098     awaitAndPrintReport (<span class="keywordtype">void</span>);
00099 
00100     <span class="keywordtype">void</span>
00101     printTagReportData (
00102       <a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> *       pRO_ACCESS_REPORT);
00103 
00104     <span class="keywordtype">void</span>
00105     printOneTagReportData (
00106       <a class="code" href="classLLRP_1_1CTagReportData.html">CTagReportData</a> *          pTagReportData);
00107 
00108     <span class="keywordtype">void</span>
00109     handleReaderEventNotification (
00110       <a class="code" href="classLLRP_1_1CReaderEventNotificationData.html">CReaderEventNotificationData</a> *pNtfData);
00111 
00112     <span class="keywordtype">void</span>
00113     handleAntennaEvent (
00114       <a class="code" href="classLLRP_1_1CAntennaEvent.html">CAntennaEvent</a> *           pAntennaEvent);
00115 
00116     <span class="keywordtype">void</span>
00117     handleReaderExceptionEvent (
00118       <a class="code" href="classLLRP_1_1CReaderExceptionEvent.html">CReaderExceptionEvent</a> *   pReaderExceptionEvent);
00119 
00120     <span class="keywordtype">int</span>
00121     checkLLRPStatus (
00122       <a class="code" href="classLLRP_1_1CLLRPStatus.html">CLLRPStatus</a> *             pLLRPStatus,
00123       <span class="keywordtype">char</span> *                    pWhatStr);
00124 
00125     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
00126     transact (
00127       <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                pSendMsg);
00128 
00129     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
00130     recvMessage (
00131       <span class="keywordtype">int</span>                       nMaxMS);
00132 
00133     <span class="keywordtype">int</span>
00134     sendMessage (
00135       <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                pSendMsg);
00136 
00137     <span class="keywordtype">void</span>
00138     printXMLMessage (
00139       <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                pMessage);
00140 };
00141 
00142 
00143 <span class="comment">/* BEGIN forward declarations */</span>
00144 <span class="keywordtype">int</span>
00145 <a class="code" href="example1_8cpp.html#a0">main</a> (
00146   <span class="keywordtype">int</span>                           ac,
00147   <span class="keywordtype">char</span> *                        av[]);
00148 
00149 <span class="keywordtype">void</span>
00150 <a class="code" href="dx201_8cpp.html#a1">usage</a> (
00151   <span class="keywordtype">char</span> *                        pProgName);
00152 <span class="comment">/* END forward declarations */</span>
00153 
00154 
00170 <span class="keywordtype">int</span>
<a name="l00171"></a><a class="code" href="example1_8cpp.html#a0">00171</a> <a class="code" href="example1_8cpp.html#a0">main</a> (
00172   <span class="keywordtype">int</span>                           ac,
00173   <span class="keywordtype">char</span> *                        av[])
00174 {
00175     CMyApplication              myApp;
00176     <span class="keywordtype">char</span> *                      pReaderHostName;
00177     <span class="keywordtype">int</span>                         rc;
00178 
00179     <span class="comment">/*</span>
00180 <span class="comment">     * Process comand arguments, determine reader name</span>
00181 <span class="comment">     * and verbosity level.</span>
00182 <span class="comment">     */</span>
00183     <span class="keywordflow">if</span>(ac == 2)
00184     {
00185         pReaderHostName = av[1];
00186     }
00187     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ac == 3)
00188     {
00189         <span class="keywordtype">char</span> *                  p = av[1];
00190 
00191         <span class="keywordflow">while</span>(*p)
00192         {
00193             <span class="keywordflow">switch</span>(*p++)
00194             {
00195             <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:   <span class="comment">/* linux conventional option warn char */</span>
00196             <span class="keywordflow">case</span> <span class="charliteral">'/'</span>:   <span class="comment">/* Windows/DOS conventional option warn char */</span>
00197                 <span class="keywordflow">break</span>;
00198 
00199             <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00200             <span class="keywordflow">case</span> <span class="charliteral">'V'</span>:
00201                 myApp.m_Verbose++;
00202                 <span class="keywordflow">break</span>;
00203 
00204             <span class="keywordflow">default</span>:
00205                 <a class="code" href="dx201_8cpp.html#a1">usage</a>(av[0]);
00206                 <span class="comment">/* no return */</span>
00207                 <span class="keywordflow">break</span>;
00208             }
00209         }
00210 
00211         pReaderHostName = av[2];
00212     }
00213     <span class="keywordflow">else</span>
00214     {
00215         <a class="code" href="dx201_8cpp.html#a1">usage</a>(av[0]);
00216         <span class="comment">/* no return */</span>
00217     }
00218 
00219     <span class="comment">/*</span>
00220 <span class="comment">     * Run application, capture return value for exit status</span>
00221 <span class="comment">     */</span>
00222     rc = myApp.run(pReaderHostName);
00223 
00224     printf(<span class="stringliteral">"INFO: Done\n"</span>);
00225 
00226     <span class="comment">/*</span>
00227 <span class="comment">     * Exit with the right status.</span>
00228 <span class="comment">     */</span>
00229     <span class="keywordflow">if</span>(0 == rc)
00230     {
00231         exit(0);
00232     }
00233     <span class="keywordflow">else</span>
00234     {
00235         exit(2);
00236     }
00237     <span class="comment">/*NOTREACHED*/</span>
00238 }
00239 
00240 
00252 <span class="keywordtype">void</span>
<a name="l00253"></a><a class="code" href="example1_8cpp.html#a1">00253</a> <a class="code" href="dx201_8cpp.html#a1">usage</a> (
00254   <span class="keywordtype">char</span> *                        pProgName)
00255 {
00256 <span class="preprocessor">#ifdef linux</span>
00257 <span class="preprocessor"></span>    printf(<span class="stringliteral">"Usage: %s [-v[v]] READERHOSTNAME\n"</span>, pProgName);
00258     printf(<span class="stringliteral">"\n"</span>);
00259     printf(<span class="stringliteral">"Each -v increases verbosity level\n"</span>);
00260 <span class="preprocessor">#endif </span><span class="comment">/* linux */</span>
00261 <span class="preprocessor">#ifdef WIN32</span>
00262 <span class="preprocessor"></span>    printf(<span class="stringliteral">"Usage: %s [/v[v]] READERHOSTNAME\n"</span>, pProgName);
00263     printf(<span class="stringliteral">"\n"</span>);
00264     printf(<span class="stringliteral">"Each /v increases verbosity level\n"</span>);
00265 <span class="preprocessor">#endif </span><span class="comment">/* WIN32 */</span>
00266     exit(1);
00267 }
00268 
00269 
00300 <span class="keywordtype">int</span>
00301 CMyApplication::run (
00302   <span class="keywordtype">char</span> *                        pReaderHostName)
00303 {
00304     <a class="code" href="classLLRP_1_1CTypeRegistry.html">CTypeRegistry</a> *             pTypeRegistry;
00305     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn;
00306     <span class="keywordtype">int</span>                         rc;
00307 
00308     <span class="comment">/*</span>
00309 <span class="comment">     * Allocate the type registry. This is needed</span>
00310 <span class="comment">     * by the connection to decode.</span>
00311 <span class="comment">     */</span>
00312     pTypeRegistry = getTheTypeRegistry();
00313     <span class="keywordflow">if</span>(NULL == pTypeRegistry)
00314     {
00315         printf(<span class="stringliteral">"ERROR: getTheTypeRegistry failed\n"</span>);
00316         <span class="keywordflow">return</span> -1;
00317     }
00318 
00319     <span class="comment">/*</span>
00320 <span class="comment">     * Construct a connection (LLRP::CConnection).</span>
00321 <span class="comment">     * Using a 32kb max frame size for send/recv.</span>
00322 <span class="comment">     * The connection object is ready for business</span>
00323 <span class="comment">     * but not actually connected to the reader yet.</span>
00324 <span class="comment">     */</span>
00325     pConn = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a>(pTypeRegistry, 32u*1024u);
00326     <span class="keywordflow">if</span>(NULL == pConn)
00327     {
00328         printf(<span class="stringliteral">"ERROR: new CConnection failed\n"</span>);
00329         <span class="keywordflow">return</span> -2;
00330     }
00331 
00332     <span class="comment">/*</span>
00333 <span class="comment">     * Open the connection to the reader</span>
00334 <span class="comment">     */</span>
00335     <span class="keywordflow">if</span>(m_Verbose)
00336     {
00337         printf(<span class="stringliteral">"INFO: Connecting to %s....\n"</span>, pReaderHostName);
00338     }
00339 
00340     rc = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a2">openConnectionToReader</a>(pReaderHostName);
00341     <span class="keywordflow">if</span>(0 != rc)
00342     {
00343         printf(<span class="stringliteral">"ERROR: connect: %s (%d)\n"</span>, pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a3">getConnectError</a>(), rc);
00344         <span class="keyword">delete</span> pConn;
00345         <span class="keywordflow">return</span> -3;
00346     }
00347 
00348     <span class="comment">/*</span>
00349 <span class="comment">     * Record the pointer to the connection object so other</span>
00350 <span class="comment">     * routines can use it.</span>
00351 <span class="comment">     */</span>
00352     m_pConnectionToReader = pConn;
00353 
00354     <span class="keywordflow">if</span>(m_Verbose)
00355     {
00356         printf(<span class="stringliteral">"INFO: Connected, checking status....\n"</span>);
00357     }
00358 
00359     <span class="comment">/*</span>
00360 <span class="comment">     * Commence the sequence and check for errors as we go.</span>
00361 <span class="comment">     * See comments for each routine for details.</span>
00362 <span class="comment">     * Each routine prints messages.</span>
00363 <span class="comment">     */</span>
00364     rc = 1;
00365     <span class="keywordflow">if</span>(0 == checkConnectionStatus())
00366     {
00367         rc = 2;
00368         <span class="keywordflow">if</span>(0 == scrubConfiguration())
00369         {
00370             rc = 3;
00371             <span class="keywordflow">if</span>(0 == addROSpec())
00372             {
00373                 rc = 4;
00374                 <span class="keywordflow">if</span>(0 == enableROSpec())
00375                 {
00376                     <span class="keywordtype">int</span>         i;
00377 
00378                     rc = 5;
00379 
00380                     <span class="keywordflow">for</span>(i = 1; i &lt;= 5; i++)
00381                     {
00382                         printf(<span class="stringliteral">"INFO: Starting run %d ================\n"</span>, i);
00383                         <span class="keywordflow">if</span>(0 != startROSpec())
00384                         {
00385                             <span class="comment">/* already tattled */</span>
00386                             <span class="keywordflow">break</span>;
00387                         }
00388                         <span class="keywordflow">if</span>(0 != awaitAndPrintReport())
00389                         {
00390                             <span class="comment">/* already tattled */</span>
00391                             <span class="keywordflow">break</span>;
00392                         }
00393                     }
00394 
00395                     <span class="keywordflow">if</span>(5 == i)
00396                     {
00397                         rc = 0;
00398                     }
00399                 }
00400             }
00401 
00402             <span class="comment">/*</span>
00403 <span class="comment">             * After we're done, try to leave the reader</span>
00404 <span class="comment">             * in a clean state for next use. This is best</span>
00405 <span class="comment">             * effort and no checking of the result is done.</span>
00406 <span class="comment">             */</span>
00407             <span class="keywordflow">if</span>(m_Verbose)
00408             {
00409                 printf(<span class="stringliteral">"INFO: Clean up reader configuration...\n"</span>);
00410             }
00411             scrubConfiguration();
00412         }
00413     }
00414 
00415     <span class="keywordflow">if</span>(m_Verbose)
00416     {
00417         printf(<span class="stringliteral">"INFO: Finished\n"</span>);
00418     }
00419 
00420     <span class="comment">/*</span>
00421 <span class="comment">     * Close the connection and release its resources</span>
00422 <span class="comment">     */</span>
00423     pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a4">closeConnectionToReader</a>();
00424     <span class="keyword">delete</span> pConn;
00425 
00426     <span class="comment">/*</span>
00427 <span class="comment">     * Done with the registry.</span>
00428 <span class="comment">     */</span>
00429     <span class="keyword">delete</span> pTypeRegistry;
00430 
00431     <span class="comment">/*</span>
00432 <span class="comment">     * When we get here all allocated memory should have been deallocated.</span>
00433 <span class="comment">     */</span>
00434 
00435     <span class="keywordflow">return</span> rc;
00436 }
00437 
00438 
00469 <span class="keywordtype">int</span>
00470 CMyApplication::checkConnectionStatus (<span class="keywordtype">void</span>)
00471 {
00472     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pMessage;
00473     <a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *pNtf;
00474     <a class="code" href="classLLRP_1_1CReaderEventNotificationData.html">CReaderEventNotificationData</a> *pNtfData;
00475     <a class="code" href="classLLRP_1_1CConnectionAttemptEvent.html">CConnectionAttemptEvent</a> *   pEvent;
00476 
00477     <span class="comment">/*</span>
00478 <span class="comment">     * Expect the notification within 10 seconds.</span>
00479 <span class="comment">     * It is suppose to be the very first message sent.</span>
00480 <span class="comment">     */</span>
00481     pMessage = recvMessage(10000);
00482 
00483     <span class="comment">/*</span>
00484 <span class="comment">     * recvMessage() returns NULL if something went wrong.</span>
00485 <span class="comment">     */</span>
00486     <span class="keywordflow">if</span>(NULL == pMessage)
00487     {
00488         <span class="comment">/* recvMessage already tattled */</span>
00489         <span class="keywordflow">goto</span> fail;
00490     }
00491 
00492     <span class="comment">/*</span>
00493 <span class="comment">     * Check to make sure the message is of the right type.</span>
00494 <span class="comment">     * The type label (pointer) in the message should be</span>
00495 <span class="comment">     * the type descriptor for READER_EVENT_NOTIFICATION.</span>
00496 <span class="comment">     */</span>
00497     <span class="keywordflow">if</span>(&amp;CREADER_EVENT_NOTIFICATION::s_typeDescriptor != pMessage-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>)
00498     {
00499         <span class="keywordflow">goto</span> fail;
00500     }
00501 
00502     <span class="comment">/*</span>
00503 <span class="comment">     * Now that we are sure it is a READER_EVENT_NOTIFICATION,</span>
00504 <span class="comment">     * traverse to the ReaderEventNotificationData parameter.</span>
00505 <span class="comment">     */</span>
00506     pNtf = (<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *) pMessage;
00507     pNtfData = pNtf-&gt;<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html#a2">getReaderEventNotificationData</a>();
00508     <span class="keywordflow">if</span>(NULL == pNtfData)
00509     {
00510         <span class="keywordflow">goto</span> fail;
00511     }
00512 
00513     <span class="comment">/*</span>
00514 <span class="comment">     * The ConnectionAttemptEvent parameter must be present.</span>
00515 <span class="comment">     */</span>
00516     pEvent = pNtfData-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationData.html#a22">getConnectionAttemptEvent</a>();
00517     <span class="keywordflow">if</span>(NULL == pEvent)
00518     {
00519         <span class="keywordflow">goto</span> fail;
00520     }
00521 
00522     <span class="comment">/*</span>
00523 <span class="comment">     * The status in the ConnectionAttemptEvent parameter</span>
00524 <span class="comment">     * must indicate connection success.</span>
00525 <span class="comment">     */</span>
00526     <span class="keywordflow">if</span>(<a class="code" href="namespaceLLRP.html#a313a125">ConnectionAttemptStatusType_Success</a> != pEvent-&gt;<a class="code" href="classLLRP_1_1CConnectionAttemptEvent.html#a2">getStatus</a>())
00527     {
00528         <span class="keywordflow">goto</span> fail;
00529     }
00530 
00531     <span class="comment">/*</span>
00532 <span class="comment">     * Done with the message</span>
00533 <span class="comment">     */</span>
00534     <span class="keyword">delete</span> pMessage;
00535 
00536     <span class="keywordflow">if</span>(m_Verbose)
00537     {
00538         printf(<span class="stringliteral">"INFO: Connection status OK\n"</span>);
00539     }
00540 
00541     <span class="comment">/*</span>
00542 <span class="comment">     * Victory.</span>
00543 <span class="comment">     */</span>
00544     <span class="keywordflow">return</span> 0;
00545 
00546   fail:
00547     <span class="comment">/*</span>
00548 <span class="comment">     * Something went wrong. Tattle. Clean up. Return error.</span>
00549 <span class="comment">     */</span>
00550     printf(<span class="stringliteral">"ERROR: checkConnectionStatus failed\n"</span>);
00551     <span class="keyword">delete</span> pMessage;
00552     <span class="keywordflow">return</span> -1;
00553 }
00554 
00555 
00572 <span class="keywordtype">int</span>
00573 CMyApplication::scrubConfiguration (<span class="keywordtype">void</span>)
00574 {
00575     <span class="keywordflow">if</span>(0 != resetConfigurationToFactoryDefaults())
00576     {
00577         <span class="keywordflow">return</span> -1;
00578     }
00579 
00580     <span class="keywordflow">if</span>(0 != deleteAllROSpecs())
00581     {
00582         <span class="keywordflow">return</span> -2;
00583     }
00584 
00585     <span class="keywordflow">return</span> 0;
00586 }
00587 
00588 
00609 <span class="keywordtype">int</span>
00610 CMyApplication::resetConfigurationToFactoryDefaults (<span class="keywordtype">void</span>)
00611 {
00612     <a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html">CSET_READER_CONFIG</a> *        pCmd;
00613     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00614     <a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html">CSET_READER_CONFIG_RESPONSE</a> *pRsp;
00615 
00616     <span class="comment">/*</span>
00617 <span class="comment">     * Compose the command message</span>
00618 <span class="comment">     */</span>
00619     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html">CSET_READER_CONFIG</a>();
00620     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(101);
00621     pCmd-&gt;<a class="code" href="classLLRP_1_1CSET__READER__CONFIG.html#a3">setResetToFactoryDefault</a>(1);
00622 
00623     <span class="comment">/*</span>
00624 <span class="comment">     * Send the message, expect the response of certain type</span>
00625 <span class="comment">     */</span>
00626     pRspMsg = transact(pCmd);
00627 
00628     <span class="comment">/*</span>
00629 <span class="comment">     * Done with the command message</span>
00630 <span class="comment">     */</span>
00631     <span class="keyword">delete</span> pCmd;
00632 
00633     <span class="comment">/*</span>
00634 <span class="comment">     * transact() returns NULL if something went wrong.</span>
00635 <span class="comment">     */</span>
00636     <span class="keywordflow">if</span>(NULL == pRspMsg)
00637     {
00638         <span class="comment">/* transact already tattled */</span>
00639         <span class="keywordflow">return</span> -1;
00640     }
00641 
00642     <span class="comment">/*</span>
00643 <span class="comment">     * Cast to a SET_READER_CONFIG_RESPONSE message.</span>
00644 <span class="comment">     */</span>
00645     pRsp = (<a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html">CSET_READER_CONFIG_RESPONSE</a> *) pRspMsg;
00646 
00647     <span class="comment">/*</span>
00648 <span class="comment">     * Check the LLRPStatus parameter.</span>
00649 <span class="comment">     */</span>
00650     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CSET__READER__CONFIG__RESPONSE.html#a2">getLLRPStatus</a>(),
00651                         <span class="stringliteral">"resetConfigurationToFactoryDefaults"</span>))
00652     {
00653         <span class="comment">/* checkLLRPStatus already tattled */</span>
00654         <span class="keyword">delete</span> pRspMsg;
00655         <span class="keywordflow">return</span> -1;
00656     }
00657 
00658     <span class="comment">/*</span>
00659 <span class="comment">     * Done with the response message.</span>
00660 <span class="comment">     */</span>
00661     <span class="keyword">delete</span> pRspMsg;
00662 
00663     <span class="comment">/*</span>
00664 <span class="comment">     * Tattle progress, maybe</span>
00665 <span class="comment">     */</span>
00666     <span class="keywordflow">if</span>(m_Verbose)
00667     {
00668         printf(<span class="stringliteral">"INFO: Configuration reset to factory defaults\n"</span>);
00669     }
00670 
00671     <span class="comment">/*</span>
00672 <span class="comment">     * Victory.</span>
00673 <span class="comment">     */</span>
00674     <span class="keywordflow">return</span> 0;
00675 }
00676 
00677 
00697 <span class="keywordtype">int</span>
00698 CMyApplication::deleteAllROSpecs (<span class="keywordtype">void</span>)
00699 {
00700     <a class="code" href="classLLRP_1_1CDELETE__ROSPEC.html">CDELETE_ROSPEC</a> *            pCmd;
00701     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00702     <a class="code" href="classLLRP_1_1CDELETE__ROSPEC__RESPONSE.html">CDELETE_ROSPEC_RESPONSE</a> *   pRsp;
00703 
00704     <span class="comment">/*</span>
00705 <span class="comment">     * Compose the command message</span>
00706 <span class="comment">     */</span>
00707     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CDELETE__ROSPEC.html">CDELETE_ROSPEC</a>();
00708     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(102);
00709     pCmd-&gt;<a class="code" href="classLLRP_1_1CDELETE__ROSPEC.html#a3">setROSpecID</a>(0);               <span class="comment">/* All */</span>
00710 
00711     <span class="comment">/*</span>
00712 <span class="comment">     * Send the message, expect the response of certain type</span>
00713 <span class="comment">     */</span>
00714     pRspMsg = transact(pCmd);
00715 
00716     <span class="comment">/*</span>
00717 <span class="comment">     * Done with the command message</span>
00718 <span class="comment">     */</span>
00719     <span class="keyword">delete</span> pCmd;
00720 
00721     <span class="comment">/*</span>
00722 <span class="comment">     * transact() returns NULL if something went wrong.</span>
00723 <span class="comment">     */</span>
00724     <span class="keywordflow">if</span>(NULL == pRspMsg)
00725     {
00726         <span class="comment">/* transact already tattled */</span>
00727         <span class="keywordflow">return</span> -1;
00728     }
00729 
00730     <span class="comment">/*</span>
00731 <span class="comment">     * Cast to a DELETE_ROSPEC_RESPONSE message.</span>
00732 <span class="comment">     */</span>
00733     pRsp = (<a class="code" href="classLLRP_1_1CDELETE__ROSPEC__RESPONSE.html">CDELETE_ROSPEC_RESPONSE</a> *) pRspMsg;
00734 
00735     <span class="comment">/*</span>
00736 <span class="comment">     * Check the LLRPStatus parameter.</span>
00737 <span class="comment">     */</span>
00738     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CDELETE__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"deleteAllROSpecs"</span>))
00739     {
00740         <span class="comment">/* checkLLRPStatus already tattled */</span>
00741         <span class="keyword">delete</span> pRspMsg;
00742         <span class="keywordflow">return</span> -1;
00743     }
00744 
00745     <span class="comment">/*</span>
00746 <span class="comment">     * Done with the response message.</span>
00747 <span class="comment">     */</span>
00748     <span class="keyword">delete</span> pRspMsg;
00749 
00750     <span class="comment">/*</span>
00751 <span class="comment">     * Tattle progress, maybe</span>
00752 <span class="comment">     */</span>
00753     <span class="keywordflow">if</span>(m_Verbose)
00754     {
00755         printf(<span class="stringliteral">"INFO: All ROSpecs are deleted\n"</span>);
00756     }
00757 
00758     <span class="comment">/*</span>
00759 <span class="comment">     * Victory.</span>
00760 <span class="comment">     */</span>
00761     <span class="keywordflow">return</span> 0;
00762 }
00763 
00764 
00836 <span class="keywordtype">int</span>
00837 CMyApplication::addROSpec (<span class="keywordtype">void</span>)
00838 {
00839     <a class="code" href="classLLRP_1_1CROSpecStartTrigger.html">CROSpecStartTrigger</a> *       pROSpecStartTrigger =
00840                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROSpecStartTrigger.html">CROSpecStartTrigger</a>();
00841     pROSpecStartTrigger-&gt;<a class="code" href="classLLRP_1_1CROSpecStartTrigger.html#a3">setROSpecStartTriggerType</a>(
00842                                 ROSpecStartTriggerType_Null);
00843 
00844     <a class="code" href="classLLRP_1_1CROSpecStopTrigger.html">CROSpecStopTrigger</a> *        pROSpecStopTrigger = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROSpecStopTrigger.html">CROSpecStopTrigger</a>();
00845     pROSpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CROSpecStopTrigger.html#a3">setROSpecStopTriggerType</a>(ROSpecStopTriggerType_Null);
00846     pROSpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CROSpecStopTrigger.html#a5">setDurationTriggerValue</a>(0);     <span class="comment">/* n/a */</span>
00847 
00848     <a class="code" href="classLLRP_1_1CROBoundarySpec.html">CROBoundarySpec</a> *           pROBoundarySpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROBoundarySpec.html">CROBoundarySpec</a>();
00849     pROBoundarySpec-&gt;<a class="code" href="classLLRP_1_1CROBoundarySpec.html#a3">setROSpecStartTrigger</a>(pROSpecStartTrigger);
00850     pROBoundarySpec-&gt;<a class="code" href="classLLRP_1_1CROBoundarySpec.html#a5">setROSpecStopTrigger</a>(pROSpecStopTrigger);
00851 
00852     <a class="code" href="classLLRP_1_1CAISpecStopTrigger.html">CAISpecStopTrigger</a> *        pAISpecStopTrigger = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CAISpecStopTrigger.html">CAISpecStopTrigger</a>();
00853     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a3">setAISpecStopTriggerType</a>(
00854             AISpecStopTriggerType_Duration);
00855     pAISpecStopTrigger-&gt;<a class="code" href="classLLRP_1_1CAISpecStopTrigger.html#a5">setDurationTrigger</a>(5000);
00856 
00857     <a class="code" href="classLLRP_1_1CInventoryParameterSpec.html">CInventoryParameterSpec</a> *   pInventoryParameterSpec =
00858                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CInventoryParameterSpec.html">CInventoryParameterSpec</a>();
00859     pInventoryParameterSpec-&gt;<a class="code" href="classLLRP_1_1CInventoryParameterSpec.html#a3">setInventoryParameterSpecID</a>(1234);
00860     pInventoryParameterSpec-&gt;<a class="code" href="classLLRP_1_1CInventoryParameterSpec.html#a5">setProtocolID</a>(AirProtocols_EPCGlobalClass1Gen2);
00861 
00862     <a class="code" href="classLLRP_1_1llrp__u16v__t.html">llrp_u16v_t</a>                 AntennaIDs = <a class="code" href="classLLRP_1_1llrp__u16v__t.html">llrp_u16v_t</a>(1);
00863     AntennaIDs.<a class="code" href="classLLRP_1_1llrp__u16v__t.html#o1">m_pValue</a>[0] = 0;         <span class="comment">/* All */</span>
00864 
00865     <a class="code" href="classLLRP_1_1CAISpec.html">CAISpec</a> *                   pAISpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CAISpec.html">CAISpec</a>();
00866     pAISpec-&gt;<a class="code" href="classLLRP_1_1CAISpec.html#a3">setAntennaIDs</a>(AntennaIDs);
00867     pAISpec-&gt;<a class="code" href="classLLRP_1_1CAISpec.html#a5">setAISpecStopTrigger</a>(pAISpecStopTrigger);
00868     pAISpec-&gt;<a class="code" href="classLLRP_1_1CAISpec.html#a10">addInventoryParameterSpec</a>(pInventoryParameterSpec);
00869 
00870     <a class="code" href="classLLRP_1_1CTagReportContentSelector.html">CTagReportContentSelector</a> * pTagReportContentSelector =
00871                                     <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CTagReportContentSelector.html">CTagReportContentSelector</a>();
00872     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a3">setEnableROSpecID</a>(FALSE);
00873     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a5">setEnableSpecIndex</a>(FALSE);
00874     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a7">setEnableInventoryParameterSpecID</a>(FALSE);
00875     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a9">setEnableAntennaID</a>(FALSE);
00876     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a11">setEnableChannelIndex</a>(FALSE);
00877     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a13">setEnablePeakRSSI</a>(FALSE);
00878     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a15">setEnableFirstSeenTimestamp</a>(FALSE);
00879     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a17">setEnableLastSeenTimestamp</a>(FALSE);
00880     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a19">setEnableTagSeenCount</a>(FALSE);
00881     pTagReportContentSelector-&gt;<a class="code" href="classLLRP_1_1CTagReportContentSelector.html#a21">setEnableAccessSpecID</a>(FALSE);
00882 
00883     <a class="code" href="classLLRP_1_1CROReportSpec.html">CROReportSpec</a> *             pROReportSpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROReportSpec.html">CROReportSpec</a>();
00884     pROReportSpec-&gt;<a class="code" href="classLLRP_1_1CROReportSpec.html#a3">setROReportTrigger</a>(
00885             ROReportTriggerType_Upon_N_Tags_Or_End_Of_ROSpec);
00886     pROReportSpec-&gt;<a class="code" href="classLLRP_1_1CROReportSpec.html#a5">setN</a>(0);         <span class="comment">/* Unlimited */</span>
00887     pROReportSpec-&gt;<a class="code" href="classLLRP_1_1CROReportSpec.html#a7">setTagReportContentSelector</a>(pTagReportContentSelector);
00888 
00889     <a class="code" href="classLLRP_1_1CROSpec.html">CROSpec</a> *                   pROSpec = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CROSpec.html">CROSpec</a>();
00890     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a3">setROSpecID</a>(123);
00891     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a5">setPriority</a>(0);
00892     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a7">setCurrentState</a>(ROSpecState_Disabled);
00893     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a9">setROBoundarySpec</a>(pROBoundarySpec);
00894     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a14">addSpecParameter</a>(pAISpec);
00895     pROSpec-&gt;<a class="code" href="classLLRP_1_1CROSpec.html#a16">setROReportSpec</a>(pROReportSpec);
00896 
00897     <a class="code" href="classLLRP_1_1CADD__ROSPEC.html">CADD_ROSPEC</a> *               pCmd;
00898     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00899     <a class="code" href="classLLRP_1_1CADD__ROSPEC__RESPONSE.html">CADD_ROSPEC_RESPONSE</a> *      pRsp;
00900 
00901     <span class="comment">/*</span>
00902 <span class="comment">     * Compose the command message.</span>
00903 <span class="comment">     * N.B.: After the message is composed, all the parameters</span>
00904 <span class="comment">     *       constructed, immediately above, are considered "owned"</span>
00905 <span class="comment">     *       by the command message. When it is destructed so</span>
00906 <span class="comment">     *       too will the parameters be.</span>
00907 <span class="comment">     */</span>
00908     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CADD__ROSPEC.html">CADD_ROSPEC</a>();
00909     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(201);
00910     pCmd-&gt;<a class="code" href="classLLRP_1_1CADD__ROSPEC.html#a3">setROSpec</a>(pROSpec);
00911 
00912     <span class="comment">/*</span>
00913 <span class="comment">     * Send the message, expect the response of certain type</span>
00914 <span class="comment">     */</span>
00915     pRspMsg = transact(pCmd);
00916 
00917     <span class="comment">/*</span>
00918 <span class="comment">     * Done with the command message.</span>
00919 <span class="comment">     * N.B.: And the parameters</span>
00920 <span class="comment">     */</span>
00921     <span class="keyword">delete</span> pCmd;
00922 
00923     <span class="comment">/*</span>
00924 <span class="comment">     * transact() returns NULL if something went wrong.</span>
00925 <span class="comment">     */</span>
00926     <span class="keywordflow">if</span>(NULL == pRspMsg)
00927     {
00928         <span class="comment">/* transact already tattled */</span>
00929         <span class="keywordflow">return</span> -1;
00930     }
00931 
00932     <span class="comment">/*</span>
00933 <span class="comment">     * Cast to a ADD_ROSPEC_RESPONSE message.</span>
00934 <span class="comment">     */</span>
00935     pRsp = (<a class="code" href="classLLRP_1_1CADD__ROSPEC__RESPONSE.html">CADD_ROSPEC_RESPONSE</a> *) pRspMsg;
00936 
00937     <span class="comment">/*</span>
00938 <span class="comment">     * Check the LLRPStatus parameter.</span>
00939 <span class="comment">     */</span>
00940     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CADD__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"addROSpec"</span>))
00941     {
00942         <span class="comment">/* checkLLRPStatus already tattled */</span>
00943         <span class="keyword">delete</span> pRspMsg;
00944         <span class="keywordflow">return</span> -1;
00945     }
00946 
00947     <span class="comment">/*</span>
00948 <span class="comment">     * Done with the response message.</span>
00949 <span class="comment">     */</span>
00950     <span class="keyword">delete</span> pRspMsg;
00951 
00952     <span class="comment">/*</span>
00953 <span class="comment">     * Tattle progress, maybe</span>
00954 <span class="comment">     */</span>
00955     <span class="keywordflow">if</span>(m_Verbose)
00956     {
00957         printf(<span class="stringliteral">"INFO: ROSpec added\n"</span>);
00958     }
00959 
00960     <span class="comment">/*</span>
00961 <span class="comment">     * Victory.</span>
00962 <span class="comment">     */</span>
00963     <span class="keywordflow">return</span> 0;
00964 }
00965 
00966 
00984 <span class="keywordtype">int</span>
00985 CMyApplication::enableROSpec (<span class="keywordtype">void</span>)
00986 {
00987     <a class="code" href="classLLRP_1_1CENABLE__ROSPEC.html">CENABLE_ROSPEC</a> *            pCmd;
00988     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
00989     <a class="code" href="classLLRP_1_1CENABLE__ROSPEC__RESPONSE.html">CENABLE_ROSPEC_RESPONSE</a> *   pRsp;
00990 
00991     <span class="comment">/*</span>
00992 <span class="comment">     * Compose the command message</span>
00993 <span class="comment">     */</span>
00994     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CENABLE__ROSPEC.html">CENABLE_ROSPEC</a>();
00995     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(202);
00996     pCmd-&gt;<a class="code" href="classLLRP_1_1CENABLE__ROSPEC.html#a3">setROSpecID</a>(123);
00997 
00998     <span class="comment">/*</span>
00999 <span class="comment">     * Send the message, expect the response of certain type</span>
01000 <span class="comment">     */</span>
01001     pRspMsg = transact(pCmd);
01002 
01003     <span class="comment">/*</span>
01004 <span class="comment">     * Done with the command message</span>
01005 <span class="comment">     */</span>
01006     <span class="keyword">delete</span> pCmd;
01007 
01008     <span class="comment">/*</span>
01009 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01010 <span class="comment">     */</span>
01011     <span class="keywordflow">if</span>(NULL == pRspMsg)
01012     {
01013         <span class="comment">/* transact already tattled */</span>
01014         <span class="keywordflow">return</span> -1;
01015     }
01016 
01017     <span class="comment">/*</span>
01018 <span class="comment">     * Cast to a ENABLE_ROSPEC_RESPONSE message.</span>
01019 <span class="comment">     */</span>
01020     pRsp = (<a class="code" href="classLLRP_1_1CENABLE__ROSPEC__RESPONSE.html">CENABLE_ROSPEC_RESPONSE</a> *) pRspMsg;
01021 
01022     <span class="comment">/*</span>
01023 <span class="comment">     * Check the LLRPStatus parameter.</span>
01024 <span class="comment">     */</span>
01025     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CENABLE__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"enableROSpec"</span>))
01026     {
01027         <span class="comment">/* checkLLRPStatus already tattled */</span>
01028         <span class="keyword">delete</span> pRspMsg;
01029         <span class="keywordflow">return</span> -1;
01030     }
01031 
01032     <span class="comment">/*</span>
01033 <span class="comment">     * Done with the response message.</span>
01034 <span class="comment">     */</span>
01035     <span class="keyword">delete</span> pRspMsg;
01036 
01037     <span class="comment">/*</span>
01038 <span class="comment">     * Tattle progress, maybe</span>
01039 <span class="comment">     */</span>
01040     <span class="keywordflow">if</span>(m_Verbose)
01041     {
01042         printf(<span class="stringliteral">"INFO: ROSpec enabled\n"</span>);
01043     }
01044 
01045     <span class="comment">/*</span>
01046 <span class="comment">     * Victory.</span>
01047 <span class="comment">     */</span>
01048     <span class="keywordflow">return</span> 0;
01049 }
01050 
01051 
01069 <span class="keywordtype">int</span>
01070 CMyApplication::startROSpec (<span class="keywordtype">void</span>)
01071 {
01072     <a class="code" href="classLLRP_1_1CSTART__ROSPEC.html">CSTART_ROSPEC</a> *             pCmd;
01073     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
01074     <a class="code" href="classLLRP_1_1CSTART__ROSPEC__RESPONSE.html">CSTART_ROSPEC_RESPONSE</a> *    pRsp;
01075 
01076     <span class="comment">/*</span>
01077 <span class="comment">     * Compose the command message</span>
01078 <span class="comment">     */</span>
01079     pCmd = <span class="keyword">new</span> <a class="code" href="classLLRP_1_1CSTART__ROSPEC.html">CSTART_ROSPEC</a>();
01080     pCmd-&gt;<a class="code" href="classLLRP_1_1CMessage.html#a1">setMessageID</a>(202);
01081     pCmd-&gt;<a class="code" href="classLLRP_1_1CSTART__ROSPEC.html#a3">setROSpecID</a>(123);
01082 
01083     <span class="comment">/*</span>
01084 <span class="comment">     * Send the message, expect the response of certain type</span>
01085 <span class="comment">     */</span>
01086     pRspMsg = transact(pCmd);
01087 
01088     <span class="comment">/*</span>
01089 <span class="comment">     * Done with the command message</span>
01090 <span class="comment">     */</span>
01091     <span class="keyword">delete</span> pCmd;
01092 
01093     <span class="comment">/*</span>
01094 <span class="comment">     * transact() returns NULL if something went wrong.</span>
01095 <span class="comment">     */</span>
01096     <span class="keywordflow">if</span>(NULL == pRspMsg)
01097     {
01098         <span class="comment">/* transact already tattled */</span>
01099         <span class="keywordflow">return</span> -1;
01100     }
01101 
01102     <span class="comment">/*</span>
01103 <span class="comment">     * Cast to a START_ROSPEC_RESPONSE message.</span>
01104 <span class="comment">     */</span>
01105     pRsp = (<a class="code" href="classLLRP_1_1CSTART__ROSPEC__RESPONSE.html">CSTART_ROSPEC_RESPONSE</a> *) pRspMsg;
01106 
01107     <span class="comment">/*</span>
01108 <span class="comment">     * Check the LLRPStatus parameter.</span>
01109 <span class="comment">     */</span>
01110     <span class="keywordflow">if</span>(0 != checkLLRPStatus(pRsp-&gt;<a class="code" href="classLLRP_1_1CSTART__ROSPEC__RESPONSE.html#a2">getLLRPStatus</a>(), <span class="stringliteral">"startROSpec"</span>))
01111     {
01112         <span class="comment">/* checkLLRPStatus already tattled */</span>
01113         <span class="keyword">delete</span> pRspMsg;
01114         <span class="keywordflow">return</span> -1;
01115     }
01116 
01117     <span class="comment">/*</span>
01118 <span class="comment">     * Done with the response message.</span>
01119 <span class="comment">     */</span>
01120     <span class="keyword">delete</span> pRspMsg;
01121 
01122     <span class="comment">/*</span>
01123 <span class="comment">     * Tattle progress</span>
01124 <span class="comment">     */</span>
01125     <span class="keywordflow">if</span>(m_Verbose)
01126     {
01127         printf(<span class="stringliteral">"INFO: ROSpec started\n"</span>);
01128     }
01129 
01130     <span class="comment">/*</span>
01131 <span class="comment">     * Victory.</span>
01132 <span class="comment">     */</span>
01133     <span class="keywordflow">return</span> 0;
01134 }
01135 
01136 
01152 <span class="keywordtype">int</span>
01153 CMyApplication::awaitAndPrintReport (<span class="keywordtype">void</span>)
01154 {
01155     <span class="keywordtype">int</span>                         bDone = 0;
01156     <span class="keywordtype">int</span>                         retVal = 0;
01157 
01158     <span class="comment">/*</span>
01159 <span class="comment">     * Keep receiving messages until done or until</span>
01160 <span class="comment">     * something bad happens.</span>
01161 <span class="comment">     */</span>
01162     <span class="keywordflow">while</span>(!bDone)
01163     {
01164         <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *              pMessage;
01165         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CTypeDescriptor.html">CTypeDescriptor</a> * pType;
01166 
01167         <span class="comment">/*</span>
01168 <span class="comment">         * Wait up to 7 seconds for a message. The report</span>
01169 <span class="comment">         * should occur within 5 seconds.</span>
01170 <span class="comment">         */</span>
01171         pMessage = recvMessage(7000);
01172         <span class="keywordflow">if</span>(NULL == pMessage)
01173         {
01174             <span class="comment">/*</span>
01175 <span class="comment">             * Did not receive a message within a reasonable</span>
01176 <span class="comment">             * amount of time. recvMessage() already tattled</span>
01177 <span class="comment">             */</span>
01178             retVal = -2;
01179             bDone = 1;
01180             <span class="keywordflow">continue</span>;
01181         }
01182 
01183         <span class="comment">/*</span>
01184 <span class="comment">         * What happens depends on what kind of message</span>
01185 <span class="comment">         * received. Use the type label (m_pType) to</span>
01186 <span class="comment">         * discriminate message types.</span>
01187 <span class="comment">         */</span>
01188         pType = pMessage-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>;
01189 
01190         <span class="comment">/*</span>
01191 <span class="comment">         * Is it a tag report? If so, print it out.</span>
01192 <span class="comment">         */</span>
01193         <span class="keywordflow">if</span>(&amp;CRO_ACCESS_REPORT::s_typeDescriptor == pType)
01194         {
01195             <a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> * pNtf;
01196 
01197             pNtf = (<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> *) pMessage;
01198 
01199             printTagReportData(pNtf);
01200             bDone = 1;
01201             retVal = 0;
01202         }
01203 
01204         <span class="comment">/*</span>
01205 <span class="comment">         * Is it a reader event? This example only recognizes</span>
01206 <span class="comment">         * AntennaEvents.</span>
01207 <span class="comment">         */</span>
01208         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(&amp;CREADER_EVENT_NOTIFICATION::s_typeDescriptor == pType)
01209         {
01210             <a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *pNtf;
01211             <a class="code" href="classLLRP_1_1CReaderEventNotificationData.html">CReaderEventNotificationData</a> *pNtfData;
01212 
01213             pNtf = (<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html">CREADER_EVENT_NOTIFICATION</a> *) pMessage;
01214 
01215             pNtfData = pNtf-&gt;<a class="code" href="classLLRP_1_1CREADER__EVENT__NOTIFICATION.html#a2">getReaderEventNotificationData</a>();
01216             <span class="keywordflow">if</span>(NULL != pNtfData)
01217             {
01218                 handleReaderEventNotification(pNtfData);
01219             }
01220             <span class="keywordflow">else</span>
01221             {
01222                 <span class="comment">/*</span>
01223 <span class="comment">                 * This should never happen. Using continue</span>
01224 <span class="comment">                 * to keep indent depth down.</span>
01225 <span class="comment">                 */</span>
01226                 printf(<span class="stringliteral">"WARNING: READER_EVENT_NOTIFICATION without data\n"</span>);
01227             }
01228         }
01229 
01230         <span class="comment">/*</span>
01231 <span class="comment">         * Hmmm. Something unexpected. Just tattle and keep going.</span>
01232 <span class="comment">         */</span>
01233         <span class="keywordflow">else</span>
01234         {
01235             printf(<span class="stringliteral">"WARNING: Ignored unexpected message during monitor: %s\n"</span>,
01236                 pType-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
01237         }
01238 
01239         <span class="comment">/*</span>
01240 <span class="comment">         * Done with the received message</span>
01241 <span class="comment">         */</span>
01242         <span class="keyword">delete</span> pMessage;
01243     }
01244 
01245     <span class="keywordflow">return</span> retVal;
01246 }
01247 
01248 
01263 <span class="keywordtype">void</span>
01264 CMyApplication::printTagReportData (
01265   <a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html">CRO_ACCESS_REPORT</a> *           pRO_ACCESS_REPORT)
01266 {
01267     std::list&lt;CTagReportData *&gt;::iterator Cur;
01268     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                nEntry = 0;
01269 
01270     <span class="comment">/*</span>
01271 <span class="comment">     * Loop through and count the number of entries</span>
01272 <span class="comment">     */</span>
01273     <span class="keywordflow">for</span>(
01274         Cur = pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a2">beginTagReportData</a>();
01275         Cur != pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a3">endTagReportData</a>();
01276         Cur++)
01277     {
01278         nEntry++;
01279     }
01280 
01281     printf(<span class="stringliteral">"INFO: %u tag report entries\n"</span>, nEntry);
01282 
01283     <span class="comment">/*</span>
01284 <span class="comment">     * Loop through again and print each entry.</span>
01285 <span class="comment">     */</span>
01286     <span class="keywordflow">for</span>(
01287         Cur = pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a2">beginTagReportData</a>();
01288         Cur != pRO_ACCESS_REPORT-&gt;<a class="code" href="classLLRP_1_1CRO__ACCESS__REPORT.html#a3">endTagReportData</a>();
01289         Cur++)
01290     {
01291         printOneTagReportData(*Cur);
01292     }
01293 }
01294 
01295 
01305 <span class="keywordtype">void</span>
01306 CMyApplication::printOneTagReportData (
01307   <a class="code" href="classLLRP_1_1CTagReportData.html">CTagReportData</a> *              pTagReportData)
01308 {
01309     <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CTypeDescriptor.html">CTypeDescriptor</a> *     pType;
01310     <span class="keywordtype">char</span>                        aBuf[64];
01311 
01312     <span class="comment">/*</span>
01313 <span class="comment">     * Print the EPC. It could be an 96-bit EPC_96 parameter</span>
01314 <span class="comment">     * or an variable length EPCData parameter.</span>
01315 <span class="comment">     */</span>
01316 
01317     <a class="code" href="classLLRP_1_1CParameter.html">CParameter</a> *                pEPCParameter =
01318                                     pTagReportData-&gt;<a class="code" href="classLLRP_1_1CTagReportData.html#a2">getEPCParameter</a>();
01319 
01320     <span class="keywordflow">if</span>(NULL != pEPCParameter)
01321     {
01322         <span class="keywordtype">char</span> *              p = aBuf;
01323         <a class="code" href="classLLRP_1_1llrp__u96__t.html">llrp_u96_t</a>          my_u96;
01324         <a class="code" href="classLLRP_1_1llrp__u1v__t.html">llrp_u1v_t</a>          my_u1v;
01325         llrp_u8_t *         pValue = NULL;
01326         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        n, i;
01327 
01328         pType = pEPCParameter-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>;
01329         <span class="keywordflow">if</span>(&amp;CEPC_96::s_typeDescriptor == pType)
01330         {
01331             <a class="code" href="classLLRP_1_1CEPC__96.html">CEPC_96</a>             *pEPC_96;
01332 
01333             pEPC_96 = (<a class="code" href="classLLRP_1_1CEPC__96.html">CEPC_96</a> *) pEPCParameter;
01334             my_u96 = pEPC_96-&gt;<a class="code" href="classLLRP_1_1CEPC__96.html#a2">getEPC</a>();
01335             pValue = my_u96.<a class="code" href="classLLRP_1_1llrp__u96__t.html#o0">m_aValue</a>;
01336             n = 12u;
01337         }
01338         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(&amp;CEPCData::s_typeDescriptor == pType)
01339         {
01340             <a class="code" href="classLLRP_1_1CEPCData.html">CEPCData</a> *          pEPCData;
01341 
01342             pEPCData = (<a class="code" href="classLLRP_1_1CEPCData.html">CEPCData</a> *) pEPCParameter;
01343             my_u1v = pEPCData-&gt;<a class="code" href="classLLRP_1_1CEPCData.html#a2">getEPC</a>();
01344             pValue = my_u1v.<a class="code" href="classLLRP_1_1llrp__u1v__t.html#o1">m_pValue</a>;
01345             n = (my_u1v.<a class="code" href="classLLRP_1_1llrp__u1v__t.html#o0">m_nBit</a> + 7u) / 8u;
01346         }
01347 
01348         <span class="keywordflow">if</span>(NULL != pValue)
01349         {
01350             <span class="keywordflow">for</span>(i = 0; i &lt; n; i++)
01351             {
01352                 <span class="keywordflow">if</span>(0 &lt; i &amp;&amp; i%2 == 0)
01353                 {
01354                     *p++ = <span class="charliteral">'-'</span>;
01355                 }
01356                 sprintf(p, <span class="stringliteral">"%02X"</span>, pValue[i]);
01357                 <span class="keywordflow">while</span>(*p) p++;
01358             }
01359         }
01360         <span class="keywordflow">else</span>
01361         {
01362             strcpy(aBuf, <span class="stringliteral">"---unknown-epc-data-type---"</span>);
01363         }
01364     }
01365     <span class="keywordflow">else</span>
01366     {
01367         strcpy(aBuf, <span class="stringliteral">"---missing-epc-data---"</span>);
01368     }
01369     printf(<span class="stringliteral">"%-32s"</span>, aBuf);
01370 
01371     <span class="comment">/*</span>
01372 <span class="comment">     * End of line</span>
01373 <span class="comment">     */</span>
01374     printf(<span class="stringliteral">"\n"</span>);
01375 }
01376 
01377 
01391 <span class="keywordtype">void</span>
01392 CMyApplication::handleReaderEventNotification (
01393   <a class="code" href="classLLRP_1_1CReaderEventNotificationData.html">CReaderEventNotificationData</a> *pNtfData)
01394 {
01395     <a class="code" href="classLLRP_1_1CAntennaEvent.html">CAntennaEvent</a> *             pAntennaEvent;
01396     <a class="code" href="classLLRP_1_1CReaderExceptionEvent.html">CReaderExceptionEvent</a> *     pReaderExceptionEvent;
01397     <span class="keywordtype">int</span>                         nReported = 0;
01398 
01399     pAntennaEvent = pNtfData-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationData.html#a20">getAntennaEvent</a>();
01400     <span class="keywordflow">if</span>(NULL != pAntennaEvent)
01401     {
01402         handleAntennaEvent(pAntennaEvent);
01403         nReported++;
01404     }
01405 
01406     pReaderExceptionEvent = pNtfData-&gt;<a class="code" href="classLLRP_1_1CReaderEventNotificationData.html#a14">getReaderExceptionEvent</a>();
01407     <span class="keywordflow">if</span>(NULL != pReaderExceptionEvent)
01408     {
01409         handleReaderExceptionEvent(pReaderExceptionEvent);
01410         nReported++;
01411     }
01412 
01413     <span class="comment">/*</span>
01414 <span class="comment">     * Similarly handle other events here:</span>
01415 <span class="comment">     *      HoppingEvent</span>
01416 <span class="comment">     *      GPIEvent</span>
01417 <span class="comment">     *      ROSpecEvent</span>
01418 <span class="comment">     *      ReportBufferLevelWarningEvent</span>
01419 <span class="comment">     *      ReportBufferOverflowErrorEvent</span>
01420 <span class="comment">     *      RFSurveyEvent</span>
01421 <span class="comment">     *      AISpecEvent</span>
01422 <span class="comment">     *      ConnectionAttemptEvent</span>
01423 <span class="comment">     *      ConnectionCloseEvent</span>
01424 <span class="comment">     *      Custom</span>
01425 <span class="comment">     */</span>
01426 
01427     <span class="keywordflow">if</span>(0 == nReported)
01428     {
01429         printf(<span class="stringliteral">"NOTICE: Unexpected (unhandled) ReaderEvent\n"</span>);
01430     }
01431 }
01432 
01433 
01445 <span class="keywordtype">void</span>
01446 CMyApplication::handleAntennaEvent (
01447   <a class="code" href="classLLRP_1_1CAntennaEvent.html">CAntennaEvent</a> *               pAntennaEvent)
01448 {
01449     <a class="code" href="namespaceLLRP.html#a312">EAntennaEventType</a>           eEventType;
01450     llrp_u16_t                  AntennaID;
01451     <span class="keywordtype">char</span> *                      pStateStr;
01452 
01453     eEventType = pAntennaEvent-&gt;<a class="code" href="classLLRP_1_1CAntennaEvent.html#a2">getEventType</a>();
01454     AntennaID = pAntennaEvent-&gt;<a class="code" href="classLLRP_1_1CAntennaEvent.html#a4">getAntennaID</a>();
01455 
01456     <span class="keywordflow">switch</span>(eEventType)
01457     {
01458     <span class="keywordflow">case</span> <a class="code" href="namespaceLLRP.html#a312a123">AntennaEventType_Antenna_Disconnected</a>:
01459         pStateStr = <span class="stringliteral">"disconnected"</span>;
01460         <span class="keywordflow">break</span>;
01461 
01462     <span class="keywordflow">case</span> <a class="code" href="namespaceLLRP.html#a312a124">AntennaEventType_Antenna_Connected</a>:
01463         pStateStr = <span class="stringliteral">"connected"</span>;
01464         <span class="keywordflow">break</span>;
01465 
01466     <span class="keywordflow">default</span>:
01467         pStateStr = <span class="stringliteral">"?unknown-event?"</span>;
01468         <span class="keywordflow">break</span>;
01469     }
01470 
01471     printf(<span class="stringliteral">"NOTICE: Antenna %d is %s\n"</span>, AntennaID, pStateStr);
01472 }
01473 
01474 
01487 <span class="keywordtype">void</span>
01488 CMyApplication::handleReaderExceptionEvent (
01489   <a class="code" href="classLLRP_1_1CReaderExceptionEvent.html">CReaderExceptionEvent</a> *       pReaderExceptionEvent)
01490 {
01491     <a class="code" href="classLLRP_1_1llrp__utf8v__t.html">llrp_utf8v_t</a>                Message;
01492 
01493     Message = pReaderExceptionEvent-&gt;<a class="code" href="classLLRP_1_1CReaderExceptionEvent.html#a2">getMessage</a>();
01494 
01495     <span class="keywordflow">if</span>(0 &lt; Message.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o0">m_nValue</a> &amp;&amp; NULL != Message.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o1">m_pValue</a>)
01496     {
01497         printf(<span class="stringliteral">"NOTICE: ReaderException '%.*s'\n"</span>,
01498              Message.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o0">m_nValue</a>, Message.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o1">m_pValue</a>);
01499     }
01500     <span class="keywordflow">else</span>
01501     {
01502         printf(<span class="stringliteral">"NOTICE: ReaderException but no message\n"</span>);
01503     }
01504 }
01505 
01506 
01525 <span class="keywordtype">int</span>
01526 CMyApplication::checkLLRPStatus (
01527   <a class="code" href="classLLRP_1_1CLLRPStatus.html">CLLRPStatus</a> *                 pLLRPStatus,
01528   <span class="keywordtype">char</span> *                        pWhatStr)
01529 {
01530     <span class="comment">/*</span>
01531 <span class="comment">     * The LLRPStatus parameter is mandatory in all responses.</span>
01532 <span class="comment">     * If it is missing there should have been a decode error.</span>
01533 <span class="comment">     * This just makes sure (remember, this program is a</span>
01534 <span class="comment">     * diagnostic and suppose to catch LTKC mistakes).</span>
01535 <span class="comment">     */</span>
01536     <span class="keywordflow">if</span>(NULL == pLLRPStatus)
01537     {
01538         printf(<span class="stringliteral">"ERROR: %s missing LLRP status\n"</span>, pWhatStr);
01539         <span class="keywordflow">return</span> -1;
01540     }
01541 
01542     <span class="comment">/*</span>
01543 <span class="comment">     * Make sure the status is M_Success.</span>
01544 <span class="comment">     * If it isn't, print the error string if one.</span>
01545 <span class="comment">     * This does not try to pretty-print the status</span>
01546 <span class="comment">     * code. To get that, run this program with -vv</span>
01547 <span class="comment">     * and examine the XML output.</span>
01548 <span class="comment">     */</span>
01549     <span class="keywordflow">if</span>(<a class="code" href="namespaceLLRP.html#a314a130">StatusCode_M_Success</a> != pLLRPStatus-&gt;<a class="code" href="classLLRP_1_1CLLRPStatus.html#a2">getStatusCode</a>())
01550     {
01551         <a class="code" href="classLLRP_1_1llrp__utf8v__t.html">llrp_utf8v_t</a>            ErrorDesc;
01552 
01553         ErrorDesc = pLLRPStatus-&gt;<a class="code" href="classLLRP_1_1CLLRPStatus.html#a4">getErrorDescription</a>();
01554 
01555         <span class="keywordflow">if</span>(0 == ErrorDesc.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o0">m_nValue</a>)
01556         {
01557             printf(<span class="stringliteral">"ERROR: %s failed, no error description given\n"</span>,
01558                 pWhatStr);
01559         }
01560         <span class="keywordflow">else</span>
01561         {
01562             printf(<span class="stringliteral">"ERROR: %s failed, %.*s\n"</span>,
01563                 pWhatStr, ErrorDesc.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o0">m_nValue</a>, ErrorDesc.<a class="code" href="classLLRP_1_1llrp__utf8v__t.html#o1">m_pValue</a>);
01564         }
01565         <span class="keywordflow">return</span> -2;
01566     }
01567 
01568     <span class="comment">/*</span>
01569 <span class="comment">     * Victory. Everything is fine.</span>
01570 <span class="comment">     */</span>
01571     <span class="keywordflow">return</span> 0;
01572 }
01573 
01574 
01598 <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
01599 CMyApplication::transact (
01600   <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                    pSendMsg)
01601 {
01602     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn = m_pConnectionToReader;
01603     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pRspMsg;
01604 
01605     <span class="comment">/*</span>
01606 <span class="comment">     * Print the XML text for the outbound message if</span>
01607 <span class="comment">     * verbosity is 2 or higher.</span>
01608 <span class="comment">     */</span>
01609     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
01610     {
01611         printf(<span class="stringliteral">"\n===================================\n"</span>);
01612         printf(<span class="stringliteral">"INFO: Transact sending\n"</span>);
01613         printXMLMessage(pSendMsg);
01614     }
01615 
01616     <span class="comment">/*</span>
01617 <span class="comment">     * Send the message, expect the response of certain type.</span>
01618 <span class="comment">     * If LLRP::CConnection::transact() returns NULL then there was</span>
01619 <span class="comment">     * an error. In that case we try to print the error details.</span>
01620 <span class="comment">     */</span>
01621     pRspMsg = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a5">transact</a>(pSendMsg, 5000);
01622 
01623     <span class="keywordflow">if</span>(NULL == pRspMsg)
01624     {
01625         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CErrorDetails.html">CErrorDetails</a> *   pError = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a6">getTransactError</a>();
01626 
01627         printf(<span class="stringliteral">"ERROR: %s transact failed, %s\n"</span>,
01628             pSendMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>,
01629             pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> ? pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> : <span class="stringliteral">"no reason given"</span>);
01630 
01631         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>)
01632         {
01633             printf(<span class="stringliteral">"ERROR: ... reference type %s\n"</span>,
01634                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
01635         }
01636 
01637         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>)
01638         {
01639             printf(<span class="stringliteral">"ERROR: ... reference field %s\n"</span>,
01640                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>-&gt;<a class="code" href="classLLRP_1_1CFieldDescriptor.html#o2">m_pName</a>);
01641         }
01642 
01643         <span class="keywordflow">return</span> NULL;
01644     }
01645 
01646     <span class="comment">/*</span>
01647 <span class="comment">     * Print the XML text for the inbound message if</span>
01648 <span class="comment">     * verbosity is 2 or higher.</span>
01649 <span class="comment">     */</span>
01650     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
01651     {
01652         printf(<span class="stringliteral">"\n- - - - - - - - - - - - - - - - - -\n"</span>);
01653         printf(<span class="stringliteral">"INFO: Transact received response\n"</span>);
01654         printXMLMessage(pRspMsg);
01655     }
01656 
01657     <span class="comment">/*</span>
01658 <span class="comment">     * If it is an ERROR_MESSAGE (response from reader</span>
01659 <span class="comment">     * when it can't understand the request), tattle</span>
01660 <span class="comment">     * and declare defeat.</span>
01661 <span class="comment">     */</span>
01662     <span class="keywordflow">if</span>(&amp;CERROR_MESSAGE::s_typeDescriptor == pRspMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>)
01663     {
01664         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CTypeDescriptor.html">CTypeDescriptor</a> * pResponseType;
01665 
01666         pResponseType = pSendMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o5">m_pResponseType</a>;
01667 
01668         printf(<span class="stringliteral">"ERROR: Received ERROR_MESSAGE instead of %s\n"</span>,
01669             pResponseType-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
01670         <span class="keyword">delete</span> pRspMsg;
01671         pRspMsg = NULL;
01672     }
01673 
01674     <span class="keywordflow">return</span> pRspMsg;
01675 }
01676 
01677 
01702 <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *
01703 CMyApplication::recvMessage (
01704   <span class="keywordtype">int</span>                           nMaxMS)
01705 {
01706     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn = m_pConnectionToReader;
01707     <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                  pMessage;
01708 
01709     <span class="comment">/*</span>
01710 <span class="comment">     * Receive the message subject to a time limit</span>
01711 <span class="comment">     */</span>
01712     pMessage = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a9">recvMessage</a>(nMaxMS);
01713 
01714     <span class="comment">/*</span>
01715 <span class="comment">     * If LLRP::CConnection::recvMessage() returns NULL then there was</span>
01716 <span class="comment">     * an error. In that case we try to print the error details.</span>
01717 <span class="comment">     */</span>
01718     <span class="keywordflow">if</span>(NULL == pMessage)
01719     {
01720         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CErrorDetails.html">CErrorDetails</a> *   pError = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a11">getRecvError</a>();
01721 
01722         printf(<span class="stringliteral">"ERROR: recvMessage failed, %s\n"</span>,
01723             pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> ? pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> : <span class="stringliteral">"no reason given"</span>);
01724 
01725         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>)
01726         {
01727             printf(<span class="stringliteral">"ERROR: ... reference type %s\n"</span>,
01728                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
01729         }
01730 
01731         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>)
01732         {
01733             printf(<span class="stringliteral">"ERROR: ... reference field %s\n"</span>,
01734                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>-&gt;<a class="code" href="classLLRP_1_1CFieldDescriptor.html#o2">m_pName</a>);
01735         }
01736 
01737         <span class="keywordflow">return</span> NULL;
01738     }
01739 
01740     <span class="comment">/*</span>
01741 <span class="comment">     * Print the XML text for the inbound message if</span>
01742 <span class="comment">     * verbosity is 2 or higher.</span>
01743 <span class="comment">     */</span>
01744     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
01745     {
01746         printf(<span class="stringliteral">"\n===================================\n"</span>);
01747         printf(<span class="stringliteral">"INFO: Message received\n"</span>);
01748         printXMLMessage(pMessage);
01749     }
01750 
01751     <span class="keywordflow">return</span> pMessage;
01752 }
01753 
01754 
01772 <span class="keywordtype">int</span>
01773 CMyApplication::sendMessage (
01774   <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                    pSendMsg)
01775 {
01776     <a class="code" href="classLLRP_1_1CConnection.html">CConnection</a> *               pConn = m_pConnectionToReader;
01777 
01778     <span class="comment">/*</span>
01779 <span class="comment">     * Print the XML text for the outbound message if</span>
01780 <span class="comment">     * verbosity is 2 or higher.</span>
01781 <span class="comment">     */</span>
01782     <span class="keywordflow">if</span>(1 &lt; m_Verbose)
01783     {
01784         printf(<span class="stringliteral">"\n===================================\n"</span>);
01785         printf(<span class="stringliteral">"INFO: Sending\n"</span>);
01786         printXMLMessage(pSendMsg);
01787     }
01788 
01789     <span class="comment">/*</span>
01790 <span class="comment">     * If LLRP::CConnection::sendMessage() returns other than RC_OK</span>
01791 <span class="comment">     * then there was an error. In that case we try to print</span>
01792 <span class="comment">     * the error details.</span>
01793 <span class="comment">     */</span>
01794     <span class="keywordflow">if</span>(<a class="code" href="namespaceLLRP.html#a333a251">RC_OK</a> != pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a7">sendMessage</a>(pSendMsg))
01795     {
01796         <span class="keyword">const</span> <a class="code" href="classLLRP_1_1CErrorDetails.html">CErrorDetails</a> *   pError = pConn-&gt;<a class="code" href="classLLRP_1_1CConnection.html#a8">getSendError</a>();
01797 
01798         printf(<span class="stringliteral">"ERROR: %s sendMessage failed, %s\n"</span>,
01799             pSendMsg-&gt;<a class="code" href="classLLRP_1_1CElement.html#o0">m_pType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>,
01800             pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> ? pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o1">m_pWhatStr</a> : <span class="stringliteral">"no reason given"</span>);
01801 
01802         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>)
01803         {
01804             printf(<span class="stringliteral">"ERROR: ... reference type %s\n"</span>,
01805                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o2">m_pRefType</a>-&gt;<a class="code" href="classLLRP_1_1CTypeDescriptor.html#o1">m_pName</a>);
01806         }
01807 
01808         <span class="keywordflow">if</span>(NULL != pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>)
01809         {
01810             printf(<span class="stringliteral">"ERROR: ... reference field %s\n"</span>,
01811                 pError-&gt;<a class="code" href="classLLRP_1_1CErrorDetails.html#o3">m_pRefField</a>-&gt;<a class="code" href="classLLRP_1_1CFieldDescriptor.html#o2">m_pName</a>);
01812         }
01813 
01814         <span class="keywordflow">return</span> -1;
01815     }
01816 
01817     <span class="comment">/*</span>
01818 <span class="comment">     * Victory</span>
01819 <span class="comment">     */</span>
01820     <span class="keywordflow">return</span> 0;
01821 }
01822 
01823 
01837 <span class="keywordtype">void</span>
01838 CMyApplication::printXMLMessage (
01839   <a class="code" href="classLLRP_1_1CMessage.html">CMessage</a> *                    pMessage)
01840 {
01841     <span class="keywordtype">char</span>                        aBuf[100*1024];
01842 
01843     <span class="comment">/*</span>
01844 <span class="comment">     * Convert the message to an XML string.</span>
01845 <span class="comment">     * This fills the buffer with either the XML string</span>
01846 <span class="comment">     * or an error message. The return value could</span>
01847 <span class="comment">     * be checked.</span>
01848 <span class="comment">     */</span>
01849 
01850     pMessage-&gt;<a class="code" href="classLLRP_1_1CElement.html#a6">toXMLString</a>(aBuf, <span class="keyword">sizeof</span> aBuf);
01851 
01852     <span class="comment">/*</span>
01853 <span class="comment">     * Print the XML Text to the standard output.</span>
01854 <span class="comment">     */</span>
01855     printf(<span class="stringliteral">"%s"</span>, aBuf);
01856 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 24 09:16:20 2010 for LTKCPP-- LLRP Toolkit C Plus Plus Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
